---
title: ASP.NET Core でのセッション
author: rick-anderson
description: 要求間でセッションを維持する方法を説明します。
ms.author: riande
ms.custom: mvc
ms.date: 03/06/2020
no-loc:
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/app-state
ms.openlocfilehash: 95035ec372ab6adb5bafb40f2b939c549ac6f839
ms.sourcegitcommit: 65add17f74a29a647d812b04517e46cbc78258f9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/19/2020
ms.locfileid: "88633813"
---
# <a name="session-and-state-management-in-aspnet-core"></a><span data-ttu-id="c5809-103">ASP.NET Core でのセッションと状態の管理</span><span class="sxs-lookup"><span data-stu-id="c5809-103">Session and state management in ASP.NET Core</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="c5809-104">作成者: [Rick Anderson](https://twitter.com/RickAndMSFT)、[Kirk Larkin](https://twitter.com/serpent5)、および [Diana LaRose](https://github.com/DianaLaRose)</span><span class="sxs-lookup"><span data-stu-id="c5809-104">By [Rick Anderson](https://twitter.com/RickAndMSFT), [Kirk Larkin](https://twitter.com/serpent5), and [Diana LaRose](https://github.com/DianaLaRose)</span></span>

<span data-ttu-id="c5809-105">HTTP はステートレス プロトコルです。</span><span class="sxs-lookup"><span data-stu-id="c5809-105">HTTP is a stateless protocol.</span></span> <span data-ttu-id="c5809-106">既定で、HTTP 要求は独立したメッセージであり、ユーザーの値は保持されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-106">By default, HTTP requests are independent messages that don't retain user values.</span></span> <span data-ttu-id="c5809-107">この記事では、要求間でユーザー データを保持するためのいくつかの方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c5809-107">This article describes several approaches to preserve user data between requests.</span></span>

<span data-ttu-id="c5809-108">[サンプル コードを表示またはダウンロード](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/app-state/samples)します ([ダウンロード方法](xref:index#how-to-download-a-sample))。</span><span class="sxs-lookup"><span data-stu-id="c5809-108">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/app-state/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="state-management"></a><span data-ttu-id="c5809-109">状態管理</span><span class="sxs-lookup"><span data-stu-id="c5809-109">State management</span></span>

<span data-ttu-id="c5809-110">状態は、いくつかの方法で格納することができます。</span><span class="sxs-lookup"><span data-stu-id="c5809-110">State can be stored using several approaches.</span></span> <span data-ttu-id="c5809-111">このトピックではそれぞれの方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c5809-111">Each approach is described later in this topic.</span></span>

| <span data-ttu-id="c5809-112">格納の方法</span><span class="sxs-lookup"><span data-stu-id="c5809-112">Storage approach</span></span> | <span data-ttu-id="c5809-113">格納のメカニズム</span><span class="sxs-lookup"><span data-stu-id="c5809-113">Storage mechanism</span></span> |
| ---------------- | ----------------- |
| <span data-ttu-id="c5809-114">[Cookie ](#cookies)</span><span class="sxs-lookup"><span data-stu-id="c5809-114">[Cookies](#cookies)</span></span> | <span data-ttu-id="c5809-115">HTTP cookie。</span><span class="sxs-lookup"><span data-stu-id="c5809-115">HTTP cookies.</span></span> <span data-ttu-id="c5809-116">サーバー側アプリ コードを使って格納されたデータを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="c5809-116">May include data stored using server-side app code.</span></span> |
| [<span data-ttu-id="c5809-117">セッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-117">Session state</span></span>](#session-state) | <span data-ttu-id="c5809-118">HTTP cookie とサーバー側アプリ コード</span><span class="sxs-lookup"><span data-stu-id="c5809-118">HTTP cookies and server-side app code</span></span> |
| [<span data-ttu-id="c5809-119">TempData</span><span class="sxs-lookup"><span data-stu-id="c5809-119">TempData</span></span>](#tempdata) | <span data-ttu-id="c5809-120">HTTP cookie またはセッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-120">HTTP cookies or session state</span></span> |
| [<span data-ttu-id="c5809-121">クエリ文字列</span><span class="sxs-lookup"><span data-stu-id="c5809-121">Query strings</span></span>](#query-strings) | <span data-ttu-id="c5809-122">HTTP クエリ文字列</span><span class="sxs-lookup"><span data-stu-id="c5809-122">HTTP query strings</span></span> |
| [<span data-ttu-id="c5809-123">非表示フィールド</span><span class="sxs-lookup"><span data-stu-id="c5809-123">Hidden fields</span></span>](#hidden-fields) | <span data-ttu-id="c5809-124">HTTP フォーム フィールド</span><span class="sxs-lookup"><span data-stu-id="c5809-124">HTTP form fields</span></span> |
| [<span data-ttu-id="c5809-125">HttpContext.Items</span><span class="sxs-lookup"><span data-stu-id="c5809-125">HttpContext.Items</span></span>](#httpcontextitems) | <span data-ttu-id="c5809-126">サーバー側アプリ コード</span><span class="sxs-lookup"><span data-stu-id="c5809-126">Server-side app code</span></span> |
| [<span data-ttu-id="c5809-127">キャッシュ</span><span class="sxs-lookup"><span data-stu-id="c5809-127">Cache</span></span>](#cache) | <span data-ttu-id="c5809-128">サーバー側アプリ コード</span><span class="sxs-lookup"><span data-stu-id="c5809-128">Server-side app code</span></span> |

## <a name="no-loccookies"></a><span data-ttu-id="c5809-129">Cookies</span><span class="sxs-lookup"><span data-stu-id="c5809-129">Cookies</span></span>

<span data-ttu-id="c5809-130">Cookie には、要求と要求の間でデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-130">Cookies store data across requests.</span></span> <span data-ttu-id="c5809-131">cookie は要求ごとに送信されるために、そのサイズは最小に抑える必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-131">Because cookies are sent with every request, their size should be kept to a minimum.</span></span> <span data-ttu-id="c5809-132">理想的には、識別子だけを cookie に格納し、データはアプリで格納します。</span><span class="sxs-lookup"><span data-stu-id="c5809-132">Ideally, only an identifier should be stored in a cookie with the data stored by the app.</span></span> <span data-ttu-id="c5809-133">ほとんどのブラウザーで cookie のサイズは 4096 バイトに制限されています。</span><span class="sxs-lookup"><span data-stu-id="c5809-133">Most browsers restrict cookie size to 4096 bytes.</span></span> <span data-ttu-id="c5809-134">ドメインごとに使用できる cookie の数も制限されています。</span><span class="sxs-lookup"><span data-stu-id="c5809-134">Only a limited number of cookies are available for each domain.</span></span>

<span data-ttu-id="c5809-135">cookie は改ざんされる可能性があるため、アプリで検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-135">Because cookies are subject to tampering, they must be validated by the app.</span></span> <span data-ttu-id="c5809-136">Cookie は、ユーザーが削除でき、クライアント上で期限切れになります。</span><span class="sxs-lookup"><span data-stu-id="c5809-136">Cookies can be deleted by users and expire on clients.</span></span> <span data-ttu-id="c5809-137">ただし、cookie は一般に、クライアントでデータを永続化するときに最も持続性のある形式です。</span><span class="sxs-lookup"><span data-stu-id="c5809-137">However, cookies are generally the most durable form of data persistence on the client.</span></span>

<span data-ttu-id="c5809-138">Cookie は、多くの場合、パーソナル化に利用されます。既知のユーザーのためにコンテンツをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="c5809-138">Cookies are often used for personalization, where content is customized for a known user.</span></span> <span data-ttu-id="c5809-139">ユーザーは識別されるだけであり、ほとんどの場合は認証されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-139">The user is only identified and not authenticated in most cases.</span></span> <span data-ttu-id="c5809-140">cookie には、ユーザーの名前、アカウント名、または GUID などの一意のユーザー ID を格納できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-140">The cookie can store the user's name, account name, or unique user ID such as a GUID.</span></span> <span data-ttu-id="c5809-141">cookie は、好みの Web サイトの背景色など、ユーザーの個人用設定にアクセスするために使用できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-141">The cookie can be used to access the user's personalized settings, such as their preferred website background color.</span></span>

<span data-ttu-id="c5809-142">cookie を発行し、プライバシーの問題を扱うときは、[欧州連合の一般データ保護規則 (GDPR)](https://ec.europa.eu/info/law/law-topic/data-protection) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-142">See the [European Union General Data Protection Regulations (GDPR)](https://ec.europa.eu/info/law/law-topic/data-protection) when issuing cookies and dealing with privacy concerns.</span></span> <span data-ttu-id="c5809-143">詳細については、「[General Data Protection Regulation (GDPR) support in ASP.NET Core](xref:security/gdpr)」(ASP.NET Core での一般データ保護規則 (GDPR) のサポート) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c5809-143">For more information, see [General Data Protection Regulation (GDPR) support in ASP.NET Core](xref:security/gdpr).</span></span>

## <a name="session-state"></a><span data-ttu-id="c5809-144">セッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-144">Session state</span></span>

<span data-ttu-id="c5809-145">セッション状態は、ユーザーが Web アプリを参照している期間中ユーザー データを格納するための ASP.NET Core のシナリオです。</span><span class="sxs-lookup"><span data-stu-id="c5809-145">Session state is an ASP.NET Core scenario for storage of user data while the user browses a web app.</span></span> <span data-ttu-id="c5809-146">セッション状態では、アプリで管理されているストアを使用して、クライアントからの要求間でデータを保持します。</span><span class="sxs-lookup"><span data-stu-id="c5809-146">Session state uses a store maintained by the app to persist data across requests from a client.</span></span> <span data-ttu-id="c5809-147">セッション データはキャッシュによってバックアップされ、一時的なデータと見なされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-147">The session data is backed by a cache and considered ephemeral data.</span></span> <span data-ttu-id="c5809-148">セッション データがなくても、サイトは機能し続けられる必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-148">The site should continue to function without the session data.</span></span> <span data-ttu-id="c5809-149">重要なアプリケーションのデータはユーザー データベースに格納し、パフォーマンスの最適化としてのみセッションでキャッシュする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-149">Critical application data should be stored in the user database and cached in session only as a performance optimization.</span></span>

<span data-ttu-id="c5809-150">[SignalR ハブ](xref:signalr/hubs)は HTTP コンテキストとは独立して実行する可能性があるため、[SignalR](xref:signalr/index) アプリではセッションはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="c5809-150">Session isn't supported in [SignalR](xref:signalr/index) apps because a [SignalR Hub](xref:signalr/hubs) may execute independent of an HTTP context.</span></span> <span data-ttu-id="c5809-151">このようなことは、たとえば、長いポーリング要求が HTTP コンテキストの有効期間を超えてハブによって開かれている場合に発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-151">For example, this can occur when a long polling request is held open by a hub beyond the lifetime of the request's HTTP context.</span></span>

<span data-ttu-id="c5809-152">ASP.NET Core により、セッション ID を含む cookie がクライアントに提供されて、セッションの状態が維持されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-152">ASP.NET Core maintains session state by providing a cookie to the client that contains a session ID.</span></span> <span data-ttu-id="c5809-153">cookie セッション ID:</span><span class="sxs-lookup"><span data-stu-id="c5809-153">The cookie session ID:</span></span>

* <span data-ttu-id="c5809-154">各要求でアプリに送信されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-154">Is sent to the app with each request.</span></span>
* <span data-ttu-id="c5809-155">アプリによってセッション データをフェッチするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-155">Is used by the app to fetch the session data.</span></span>

<span data-ttu-id="c5809-156">セッション状態は次の動作を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-156">Session state exhibits the following behaviors:</span></span>

* <span data-ttu-id="c5809-157">セッション cookie は、ブラウザーに固有です。</span><span class="sxs-lookup"><span data-stu-id="c5809-157">The session cookie is specific to the browser.</span></span> <span data-ttu-id="c5809-158">セッションはブラウザー間で共有されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-158">Sessions aren't shared across browsers.</span></span>
* <span data-ttu-id="c5809-159">セッション cookie は、ブラウザー セッションが終了するときに削除されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-159">Session cookies are deleted when the browser session ends.</span></span>
* <span data-ttu-id="c5809-160">cookie を受け取り、セッションが期限切れになった場合、同じセッション cookie を使用する新しいセッションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-160">If a cookie is received for an expired session, a new session is created that uses the same session cookie.</span></span>
* <span data-ttu-id="c5809-161">空のセッションは保持されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-161">Empty sessions aren't retained.</span></span> <span data-ttu-id="c5809-162">要求間でセッションを維持するには、少なくとも 1 つの値をセッションが持っている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-162">The session must have at least one value set to persist the session across requests.</span></span> <span data-ttu-id="c5809-163">セッションが保持されないと、新しい要求ごとに新しいセッション ID が生成されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-163">When a session isn't retained, a new session ID is generated for each new request.</span></span>
* <span data-ttu-id="c5809-164">アプリは、最後の要求から限られた時間だけセッションを維持します。</span><span class="sxs-lookup"><span data-stu-id="c5809-164">The app retains a session for a limited time after the last request.</span></span> <span data-ttu-id="c5809-165">アプリでは、セッション タイムアウトを設定するか、既定値の 20 分を使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-165">The app either sets the session timeout or uses the default value of 20 minutes.</span></span> <span data-ttu-id="c5809-166">セッション状態は、次のユーザー データの格納に最適です。</span><span class="sxs-lookup"><span data-stu-id="c5809-166">Session state is ideal for storing user data:</span></span>
  * <span data-ttu-id="c5809-167">特定のセッションに固有である。</span><span class="sxs-lookup"><span data-stu-id="c5809-167">That's specific to a particular session.</span></span>
  * <span data-ttu-id="c5809-168">データがセッション間で永続的に保存される必要がない。</span><span class="sxs-lookup"><span data-stu-id="c5809-168">Where the data doesn't require permanent storage across sessions.</span></span>
* <span data-ttu-id="c5809-169">セッション データは、<xref:Microsoft.AspNetCore.Http.ISession.Clear%2A?displayProperty=nameWithType> の実装が呼び出されるか、セッションが期限切れになると、削除されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-169">Session data is deleted either when the <xref:Microsoft.AspNetCore.Http.ISession.Clear%2A?displayProperty=nameWithType> implementation is called or when the session expires.</span></span>
* <span data-ttu-id="c5809-170">クライアント ブラウザーが閉じられたこと、またはクライアントでセッション cookie が削除されるか期限切れになったことを、アプリ コードに通知する既定のメカニズムはありません。</span><span class="sxs-lookup"><span data-stu-id="c5809-170">There's no default mechanism to inform app code that a client browser has been closed or when the session cookie is deleted or expired on the client.</span></span>
* <span data-ttu-id="c5809-171">セッション状態の cookie は既定では必須としてマークされていません。</span><span class="sxs-lookup"><span data-stu-id="c5809-171">Session state cookies aren't marked essential by default.</span></span> <span data-ttu-id="c5809-172">サイトの訪問者が追跡を許可しない限り、セッション状態は機能しません。</span><span class="sxs-lookup"><span data-stu-id="c5809-172">Session state isn't functional unless tracking is permitted by the site visitor.</span></span> <span data-ttu-id="c5809-173">詳細については、「<xref:security/gdpr#tempdata-provider-and-session-state-cookies-arent-essential>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-173">For more information, see <xref:security/gdpr#tempdata-provider-and-session-state-cookies-arent-essential>.</span></span>

> [!WARNING]
> <span data-ttu-id="c5809-174">セッション状態には機密データを保存しないでください。</span><span class="sxs-lookup"><span data-stu-id="c5809-174">Don't store sensitive data in session state.</span></span> <span data-ttu-id="c5809-175">ユーザーがブラウザーを閉じず、セッション cookie がクリアされない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-175">The user might not close the browser and clear the session cookie.</span></span> <span data-ttu-id="c5809-176">一部のブラウザーでは、ブラウザーのウィンドウ間で有効なセッションの cookie が維持されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-176">Some browsers maintain valid session cookies across browser windows.</span></span> <span data-ttu-id="c5809-177">セッションが 1 人のユーザーに制限されないことがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-177">A session might not be restricted to a single user.</span></span> <span data-ttu-id="c5809-178">次のユーザーが、同じセッション cookie でアプリを閲覧し続けることがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-178">The next user might continue to browse the app with the same session cookie.</span></span>

<span data-ttu-id="c5809-179">メモリ内キャッシュ プロバイダーは、アプリが存在するサーバーのメモリにセッション データを格納します。</span><span class="sxs-lookup"><span data-stu-id="c5809-179">The in-memory cache provider stores session data in the memory of the server where the app resides.</span></span> <span data-ttu-id="c5809-180">サーバー ファームのシナリオでは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c5809-180">In a server farm scenario:</span></span>

* <span data-ttu-id="c5809-181">"*固定セッション*" を使用して、個々のサーバー上の特定のアプリのインスタンスに、各セッションを結び付けます。</span><span class="sxs-lookup"><span data-stu-id="c5809-181">Use *sticky sessions* to tie each session to a specific app instance on an individual server.</span></span> <span data-ttu-id="c5809-182">[Azure App Service](https://azure.microsoft.com/services/app-service/) は[アプリケーション要求ルーティング処理 (ARR)](/iis/extensions/planning-for-arr/using-the-application-request-routing-module) を使って、既定で固定セッションを強制的に使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-182">[Azure App Service](https://azure.microsoft.com/services/app-service/) uses [Application Request Routing (ARR)](/iis/extensions/planning-for-arr/using-the-application-request-routing-module) to enforce sticky sessions by default.</span></span> <span data-ttu-id="c5809-183">ただし、固定セッションは拡張性に影響を与え、Web アプリの更新を複雑にすることがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-183">However, sticky sessions can affect scalability and complicate web app updates.</span></span> <span data-ttu-id="c5809-184">もっとよい方法は、Redis または SQL Server の分散キャッシュを使用することで、固定セッションを必要としません。</span><span class="sxs-lookup"><span data-stu-id="c5809-184">A better approach is to use a Redis or SQL Server distributed cache, which doesn't require sticky sessions.</span></span> <span data-ttu-id="c5809-185">詳細については、「<xref:performance/caching/distributed>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-185">For more information, see <xref:performance/caching/distributed>.</span></span>
* <span data-ttu-id="c5809-186">セッション cookie は <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> によって暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-186">The session cookie is encrypted via <xref:Microsoft.AspNetCore.DataProtection.IDataProtector>.</span></span> <span data-ttu-id="c5809-187">各コンピューターでセッション cookie が読み取られるようにするには、データ保護を適切に構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-187">Data Protection must be properly configured to read session cookies on each machine.</span></span> <span data-ttu-id="c5809-188">詳細については、<xref:security/data-protection/introduction> および[キー ストレージ プロバイダー](xref:security/data-protection/implementation/key-storage-providers)に関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c5809-188">For more information, see <xref:security/data-protection/introduction> and [Key storage providers](xref:security/data-protection/implementation/key-storage-providers).</span></span>

### <a name="configure-session-state"></a><span data-ttu-id="c5809-189">セッション状態を構成する</span><span class="sxs-lookup"><span data-stu-id="c5809-189">Configure session state</span></span>

<span data-ttu-id="c5809-190">[Microsoft.AspNetCore.Session](https://www.nuget.org/packages/Microsoft.AspNetCore.Session/) パッケージは:</span><span class="sxs-lookup"><span data-stu-id="c5809-190">The [Microsoft.AspNetCore.Session](https://www.nuget.org/packages/Microsoft.AspNetCore.Session/) package:</span></span>

* <span data-ttu-id="c5809-191">フレームワークによって暗黙的に含まれます。</span><span class="sxs-lookup"><span data-stu-id="c5809-191">Is included implicitly by the framework.</span></span>
* <span data-ttu-id="c5809-192">セッション状態を管理するためのミドルウェアを提供します。</span><span class="sxs-lookup"><span data-stu-id="c5809-192">Provides middleware for managing session state.</span></span>

<span data-ttu-id="c5809-193">セッション ミドルウェアを有効にするには、`Startup` に次が含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-193">To enable the session middleware, `Startup` must contain:</span></span>

* <span data-ttu-id="c5809-194">いずれかの <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> メモリ キャッシュ。</span><span class="sxs-lookup"><span data-stu-id="c5809-194">Any of the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> memory caches.</span></span> <span data-ttu-id="c5809-195">`IDistributedCache` 実装はセッションのバックアップ ストアとして利用されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-195">The `IDistributedCache` implementation is used as a backing store for session.</span></span> <span data-ttu-id="c5809-196">詳細については、「<xref:performance/caching/distributed>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-196">For more information, see <xref:performance/caching/distributed>.</span></span>
* <span data-ttu-id="c5809-197">`ConfigureServices` での <xref:Microsoft.Extensions.DependencyInjection.SessionServiceCollectionExtensions.AddSession%2A> の呼び出し。</span><span class="sxs-lookup"><span data-stu-id="c5809-197">A call to <xref:Microsoft.Extensions.DependencyInjection.SessionServiceCollectionExtensions.AddSession%2A> in `ConfigureServices`.</span></span>
* <span data-ttu-id="c5809-198">`Configure` での <xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession%2A> の呼び出し。</span><span class="sxs-lookup"><span data-stu-id="c5809-198">A call to <xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession%2A> in `Configure`.</span></span>

<span data-ttu-id="c5809-199">次のコードでは、`IDistributedCache` の既定のメモリ内実装でメモリ内セッション プロバイダーを設定する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-199">The following code shows how to set up the in-memory session provider with a default in-memory implementation of `IDistributedCache`:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Startup4.cs?name=snippet1&highlight=12-19,45)]

<span data-ttu-id="c5809-200">前のコードでは、テストを簡単にするために短いタイムアウトを設定しています。</span><span class="sxs-lookup"><span data-stu-id="c5809-200">The preceding code sets a short timeout to simplify testing.</span></span>

<span data-ttu-id="c5809-201">ミドルウェアの順序が重要です。</span><span class="sxs-lookup"><span data-stu-id="c5809-201">The order of middleware is important.</span></span>  <span data-ttu-id="c5809-202">`UseSession` を `UseRouting` の後、かつ `UseEndpoints` の前に呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c5809-202">Call `UseSession` after `UseRouting` and before `UseEndpoints`.</span></span> <span data-ttu-id="c5809-203">[ミドルウェアの順序付け](xref:fundamentals/middleware/index#order)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-203">See [Middleware Ordering](xref:fundamentals/middleware/index#order).</span></span>

<span data-ttu-id="c5809-204">[HttpContext.Session](xref:Microsoft.AspNetCore.Http.HttpContext.Session) は、セッション状態を構成した後で使用できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-204">[HttpContext.Session](xref:Microsoft.AspNetCore.Http.HttpContext.Session) is available after session state is configured.</span></span>

<span data-ttu-id="c5809-205">`UseSession` を呼び出前に `HttpContext.Session` にアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="c5809-205">`HttpContext.Session` can't be accessed before `UseSession` has been called.</span></span>

<span data-ttu-id="c5809-206">アプリが応答ストリームへの書き込みを開始した後では、新しいセッション cookie を含む新しいセッションを作成できません。</span><span class="sxs-lookup"><span data-stu-id="c5809-206">A new session with a new session cookie can't be created after the app has begun writing to the response stream.</span></span> <span data-ttu-id="c5809-207">例外は Web サーバー ログに記録され、ブラウザーには表示されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-207">The exception is recorded in the web server log and not displayed in the browser.</span></span>

### <a name="load-session-state-asynchronously"></a><span data-ttu-id="c5809-208">セッション状態を非同期的に読み込む</span><span class="sxs-lookup"><span data-stu-id="c5809-208">Load session state asynchronously</span></span>

<span data-ttu-id="c5809-209">ASP.NET Core の既定のセッション プロバイダーでは、<xref:Microsoft.AspNetCore.Http.ISession.TryGetValue%2A>、<xref:Microsoft.AspNetCore.Http.ISession.Set%2A>、または <xref:Microsoft.AspNetCore.Http.ISession.Remove%2A> メソッドの前に <xref:Microsoft.AspNetCore.Http.ISession.LoadAsync%2A?displayProperty=nameWithType> メソッドが明示的に呼び出された場合にのみ、基になる <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> バッキング ストアから非同期的にセッション レコードを読み込みます。</span><span class="sxs-lookup"><span data-stu-id="c5809-209">The default session provider in ASP.NET Core loads session records from the underlying <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> backing store asynchronously only if the <xref:Microsoft.AspNetCore.Http.ISession.LoadAsync%2A?displayProperty=nameWithType> method is explicitly called before the <xref:Microsoft.AspNetCore.Http.ISession.TryGetValue%2A>, <xref:Microsoft.AspNetCore.Http.ISession.Set%2A>, or <xref:Microsoft.AspNetCore.Http.ISession.Remove%2A> methods.</span></span> <span data-ttu-id="c5809-210">`LoadAsync` を最初に呼び出さないと、基になっているセッション レコードは同期的に読み込まれ、パフォーマンスが大幅に低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-210">If `LoadAsync` isn't called first, the underlying session record is loaded synchronously, which can incur a performance penalty at scale.</span></span>

<span data-ttu-id="c5809-211">アプリにこのパターンを強制させるには、`TryGetValue`、`Set`、または `Remove` の前に `LoadAsync` メソッドが呼び出されない場合に例外をスローするバージョンで、<xref:Microsoft.AspNetCore.Session.DistributedSessionStore> および <xref:Microsoft.AspNetCore.Session.DistributedSession> の実装をラップします。</span><span class="sxs-lookup"><span data-stu-id="c5809-211">To have apps enforce this pattern, wrap the <xref:Microsoft.AspNetCore.Session.DistributedSessionStore> and <xref:Microsoft.AspNetCore.Session.DistributedSession> implementations with versions that throw an exception if the `LoadAsync` method isn't called before `TryGetValue`, `Set`, or `Remove`.</span></span> <span data-ttu-id="c5809-212">ラップしたバージョンをサービス コンテナーに登録します。</span><span class="sxs-lookup"><span data-stu-id="c5809-212">Register the wrapped versions in the services container.</span></span>

### <a name="session-options"></a><span data-ttu-id="c5809-213">セッション オプション</span><span class="sxs-lookup"><span data-stu-id="c5809-213">Session options</span></span>

<span data-ttu-id="c5809-214">セッションの既定値をオーバーライドするには、<xref:Microsoft.AspNetCore.Builder.SessionOptions> を使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-214">To override session defaults, use <xref:Microsoft.AspNetCore.Builder.SessionOptions>.</span></span>

| <span data-ttu-id="c5809-215">オプション</span><span class="sxs-lookup"><span data-stu-id="c5809-215">Option</span></span> | <span data-ttu-id="c5809-216">説明</span><span class="sxs-lookup"><span data-stu-id="c5809-216">Description</span></span> |
| ------ | ----------- |
| <xref:Microsoft.AspNetCore.Builder.SessionOptions.Cookie> | <span data-ttu-id="c5809-217">cookie の作成に使用される設定を決定します。</span><span class="sxs-lookup"><span data-stu-id="c5809-217">Determines the settings used to create the cookie.</span></span> <span data-ttu-id="c5809-218"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Name> の既定値は <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookieName?displayProperty=nameWithType> (`.AspNetCore.Session`) です。</span><span class="sxs-lookup"><span data-stu-id="c5809-218"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Name> defaults to <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookieName?displayProperty=nameWithType> (`.AspNetCore.Session`).</span></span> <span data-ttu-id="c5809-219"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Path> の既定値は <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookiePath?displayProperty=nameWithType> (`/`) です。</span><span class="sxs-lookup"><span data-stu-id="c5809-219"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Path> defaults to <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookiePath?displayProperty=nameWithType> (`/`).</span></span> <span data-ttu-id="c5809-220"><xref:Microsoft.AspNetCore.Http.CookieBuilder.SameSite> の既定値は <xref:Microsoft.AspNetCore.Http.SameSiteMode.Lax?displayProperty=nameWithType> (`1`) です。</span><span class="sxs-lookup"><span data-stu-id="c5809-220"><xref:Microsoft.AspNetCore.Http.CookieBuilder.SameSite> defaults to <xref:Microsoft.AspNetCore.Http.SameSiteMode.Lax?displayProperty=nameWithType> (`1`).</span></span> <span data-ttu-id="c5809-221"><xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> では、既定値が `true` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-221"><xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> defaults to `true`.</span></span> <span data-ttu-id="c5809-222"><xref:Microsoft.AspNetCore.Http.CookieBuilder.IsEssential> では、既定値が `false` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-222"><xref:Microsoft.AspNetCore.Http.CookieBuilder.IsEssential> defaults to `false`.</span></span> |
| <xref:Microsoft.AspNetCore.Builder.SessionOptions.IdleTimeout> | <span data-ttu-id="c5809-223">`IdleTimeout` は、内容を破棄されることなくセッションがアイドル状態になっていることのできる最大時間を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-223">The `IdleTimeout` indicates how long the session can be idle before its contents are abandoned.</span></span> <span data-ttu-id="c5809-224">セッションへのアクセスがあるたびに、タイムアウトはリセットされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-224">Each session access resets the timeout.</span></span> <span data-ttu-id="c5809-225">この設定はセッションの内容にのみ適用され、cookie には適用されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-225">This setting only applies to the content of the session, not the cookie.</span></span> <span data-ttu-id="c5809-226">既定値は 20 分です。</span><span class="sxs-lookup"><span data-stu-id="c5809-226">The default is 20 minutes.</span></span> |
| <xref:Microsoft.AspNetCore.Builder.SessionOptions.IOTimeout> | <span data-ttu-id="c5809-227">ストアからのセッションの読み込み、またはストアに戻すコミットに対して許容される最大時間です。</span><span class="sxs-lookup"><span data-stu-id="c5809-227">The maximum amount of time allowed to load a session from the store or to commit it back to the store.</span></span> <span data-ttu-id="c5809-228">この設定は非同期操作にのみ適用できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-228">This setting may only apply to asynchronous operations.</span></span> <span data-ttu-id="c5809-229">このタイムアウトは、<xref:System.Threading.Timeout.InfiniteTimeSpan> を使用して無効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="c5809-229">This timeout can be disabled using <xref:System.Threading.Timeout.InfiniteTimeSpan>.</span></span> <span data-ttu-id="c5809-230">既定値は 1 分です。</span><span class="sxs-lookup"><span data-stu-id="c5809-230">The default is 1 minute.</span></span> |

<span data-ttu-id="c5809-231">セッションは cookie を利用し、1 つのブラウザーからの要求を追跡し、識別します。</span><span class="sxs-lookup"><span data-stu-id="c5809-231">Session uses a cookie to track and identify requests from a single browser.</span></span> <span data-ttu-id="c5809-232">既定では、この cookie は `.AspNetCore.Session` という名前であり、パス `/` が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-232">By default, this cookie is named `.AspNetCore.Session`, and it uses a path of `/`.</span></span> <span data-ttu-id="c5809-233">cookie の既定値ではドメインが指定されないため、ページのクライアント側スクリプトには使用できません (<xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> の既定値が `true` になるため)。</span><span class="sxs-lookup"><span data-stu-id="c5809-233">Because the cookie default doesn't specify a domain, it isn't made available to the client-side script on the page (because <xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> defaults to `true`).</span></span>

<span data-ttu-id="c5809-234">cookie セッションの既定値をオーバーライドするには、<xref:Microsoft.AspNetCore.Builder.SessionOptions> を使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-234">To override cookie session defaults, use <xref:Microsoft.AspNetCore.Builder.SessionOptions>:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Startup2.cs?name=snippet1&highlight=5-10)]

<span data-ttu-id="c5809-235">アプリでは、<xref:Microsoft.AspNetCore.Builder.SessionOptions.IdleTimeout> プロパティを使用して、サーバーのキャッシュ内の内容が破棄されるまでのセッションのアイドル時間が決定されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-235">The app uses the <xref:Microsoft.AspNetCore.Builder.SessionOptions.IdleTimeout> property to determine how long a session can be idle before its contents in the server's cache are abandoned.</span></span> <span data-ttu-id="c5809-236">このプロパティは cookie の有効期限に依存しません。</span><span class="sxs-lookup"><span data-stu-id="c5809-236">This property is independent of the cookie expiration.</span></span> <span data-ttu-id="c5809-237">要求が[セッション ミドルウェア](xref:Microsoft.AspNetCore.Session.SessionMiddleware)を通過するたびにタイムアウトがリセットされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-237">Each request that passes through the [Session Middleware](xref:Microsoft.AspNetCore.Session.SessionMiddleware) resets the timeout.</span></span>

<span data-ttu-id="c5809-238">セッション状態は "*ロックなし*" です。</span><span class="sxs-lookup"><span data-stu-id="c5809-238">Session state is *non-locking*.</span></span> <span data-ttu-id="c5809-239">2 つの要求がセッションの内容を同時に変更しようとした場合、最後の要求が最初の要求をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="c5809-239">If two requests simultaneously attempt to modify the contents of a session, the last request overrides the first.</span></span> <span data-ttu-id="c5809-240">`Session` は*一貫性のあるセッション*として実装されます。つまり、コンテンツは全部まとめて保管されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-240">`Session` is implemented as a *coherent session*, which means that all the contents are stored together.</span></span> <span data-ttu-id="c5809-241">2 つの要求が異なるセッション値を変更しようとしたとき、最後の要求が最初の要求によって行われたセッションの変更をオーバーライドすることがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-241">When two requests seek to modify different session values, the last request may override session changes made by the first.</span></span>

### <a name="set-and-get-session-values"></a><span data-ttu-id="c5809-242">セッション値の設定および取得</span><span class="sxs-lookup"><span data-stu-id="c5809-242">Set and get Session values</span></span>

<span data-ttu-id="c5809-243">セッション状態にアクセスするには、Razor Pages の <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel> クラスか、MVC の <xref:Microsoft.AspNetCore.Mvc.Controller> クラスを <xref:Microsoft.AspNetCore.Http.HttpContext.Session?displayProperty=nameWithType> と共に使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-243">Session state is accessed from a Razor Pages <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel> class or MVC <xref:Microsoft.AspNetCore.Mvc.Controller> class with <xref:Microsoft.AspNetCore.Http.HttpContext.Session?displayProperty=nameWithType>.</span></span> <span data-ttu-id="c5809-244">このプロパティは <xref:Microsoft.AspNetCore.Http.ISession> の実装です。</span><span class="sxs-lookup"><span data-stu-id="c5809-244">This property is an <xref:Microsoft.AspNetCore.Http.ISession> implementation.</span></span>

<span data-ttu-id="c5809-245">`ISession` の実装では、整数値や文字列値を設定および取得するための複数の拡張メソッドが提供されています。</span><span class="sxs-lookup"><span data-stu-id="c5809-245">The `ISession` implementation provides several extension methods to set and retrieve integer and string values.</span></span> <span data-ttu-id="c5809-246">拡張メソッドは <xref:Microsoft.AspNetCore.Http> 名前空間にあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-246">The extension methods are in the <xref:Microsoft.AspNetCore.Http> namespace.</span></span>

<span data-ttu-id="c5809-247">`ISession` 拡張メソッド:</span><span class="sxs-lookup"><span data-stu-id="c5809-247">`ISession` extension methods:</span></span>

* [<span data-ttu-id="c5809-248">Get(ISession, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-248">Get(ISession, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.Get%2A)
* [<span data-ttu-id="c5809-249">GetInt32(ISession, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-249">GetInt32(ISession, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.GetInt32%2A)
* [<span data-ttu-id="c5809-250">GetString(ISession, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-250">GetString(ISession, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.GetString%2A)
* [<span data-ttu-id="c5809-251">SetInt32(ISession, String, Int32)</span><span class="sxs-lookup"><span data-stu-id="c5809-251">SetInt32(ISession, String, Int32)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.SetInt32%2A)
* [<span data-ttu-id="c5809-252">SetString(ISession, String, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-252">SetString(ISession, String, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.SetString%2A)

<span data-ttu-id="c5809-253">次の例では、`IndexModel.SessionKeyName` キー (サンプル アプリ内の `_Name`) のセッション値を Razor Pages ページで取得します。</span><span class="sxs-lookup"><span data-stu-id="c5809-253">The following example retrieves the session value for the `IndexModel.SessionKeyName` key (`_Name` in the sample app) in a Razor Pages page:</span></span>

```csharp
@page
@using Microsoft.AspNetCore.Http
@model IndexModel

...

Name: @HttpContext.Session.GetString(IndexModel.SessionKeyName)
```

<span data-ttu-id="c5809-254">次の例では、整数および文字列を設定および取得する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-254">The following example shows how to set and get an integer and a string:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Pages/Index.cshtml.cs?name=snippet1&highlight=18-19,22-23)]

<span data-ttu-id="c5809-255">分散キャッシュのシナリオを有効にするには、メモリ内キャッシュを使用する場合であっても、すべてのセッション データをシリアル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-255">All session data must be serialized to enable a distributed cache scenario, even when using the in-memory cache.</span></span> <span data-ttu-id="c5809-256">文字列と整数のシリアライザーは、<xref:Microsoft.AspNetCore.Http.ISession> の拡張メソッドによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-256">String and integer serializers are provided by the extension methods of <xref:Microsoft.AspNetCore.Http.ISession>.</span></span> <span data-ttu-id="c5809-257">複合型は、JSON などの別のメカニズムを使ってユーザーがシリアル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-257">Complex types must be serialized by the user using another mechanism, such as JSON.</span></span>

<span data-ttu-id="c5809-258">次のサンプル コードを使用して、オブジェクトをシリアル化します。</span><span class="sxs-lookup"><span data-stu-id="c5809-258">Use the following sample code to serialize objects:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Extensions/SessionExtensions.cs?name=snippet1)]

<span data-ttu-id="c5809-259">次の例では、シリアル化可能オブジェクトを `SessionExtensions` クラスで設定および取得する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-259">The following example shows how to set and get a serializable object with the `SessionExtensions` class:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Pages/Index.cshtml.cs?name=snippet2)]

## <a name="tempdata"></a><span data-ttu-id="c5809-260">TempData</span><span class="sxs-lookup"><span data-stu-id="c5809-260">TempData</span></span>

<span data-ttu-id="c5809-261">ASP.NET Core によって、Razor Pages [TempData](xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel.TempData) または Controller <xref:Microsoft.AspNetCore.Mvc.Controller.TempData> が発行されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-261">ASP.NET Core exposes the Razor Pages [TempData](xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel.TempData) or Controller <xref:Microsoft.AspNetCore.Mvc.Controller.TempData>.</span></span> <span data-ttu-id="c5809-262">このプロパティには、別の要求で読み取られるまでデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-262">This property stores data until it's read in another request.</span></span> <span data-ttu-id="c5809-263">[Keep (String)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) メソッドと [Peek (String)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Peek*) メソッドを使用すると、要求の最後に削除せずにデータを調べることができます。</span><span class="sxs-lookup"><span data-stu-id="c5809-263">The [Keep(String)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) and [Peek(string)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Peek*) methods can be used to examine the data without deletion at the end of the request.</span></span> <span data-ttu-id="c5809-264">[Keep](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) によって、リテンション期間についてディクショナリ内のすべての項目がマークされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-264">[Keep](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) marks all items in the dictionary for retention.</span></span> <span data-ttu-id="c5809-265">`TempData` は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c5809-265">`TempData` is:</span></span>

* <span data-ttu-id="c5809-266">複数の要求に対してデータが必要な場合のリダイレクトに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c5809-266">Useful for redirection when data is required for more than a single request.</span></span>
* <span data-ttu-id="c5809-267">`TempData` プロバイダーによって cookie またはセッション状態を使用して実装されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-267">Implemented by `TempData` providers using either cookies or session state.</span></span>

## <a name="tempdata-samples"></a><span data-ttu-id="c5809-268">TempData のサンプル</span><span class="sxs-lookup"><span data-stu-id="c5809-268">TempData samples</span></span>

<span data-ttu-id="c5809-269">顧客を作成する次のページについて考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="c5809-269">Consider the following page that creates a customer:</span></span>

[!code-csharp[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/Create.cshtml.cs?name=snippet&highlight=15-16,30)]

<span data-ttu-id="c5809-270">次のページに `TempData["Message"]` が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-270">The following page displays `TempData["Message"]`:</span></span>

[!code-cshtml[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/IndexPeek.cshtml?range=1-14)]

<span data-ttu-id="c5809-271">前のマークアップでは、`Peek` が使用されているため、要求の最後に `TempData["Message"]` が削除**されません**。</span><span class="sxs-lookup"><span data-stu-id="c5809-271">In the preceding markup, at the end of the request, `TempData["Message"]` is **not** deleted because `Peek` is used.</span></span> <span data-ttu-id="c5809-272">ページを更新すると `TempData["Message"]` のコンテンツが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-272">Refreshing the page displays the contents of `TempData["Message"]`.</span></span>

<span data-ttu-id="c5809-273">次のマークアップは前のコードと似ていますが、`Keep` を使用して要求の最後にデータを保存しています。</span><span class="sxs-lookup"><span data-stu-id="c5809-273">The following markup is similar to the preceding code, but uses `Keep` to preserve the data at the end of the request:</span></span>

[!code-cshtml[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/IndexKeep.cshtml?range=1-14)]

<span data-ttu-id="c5809-274">*Indexpeek* ページと *IndexKeep* ページ間を移動しても `TempData["Message"]` は削除されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-274">Navigating between the *IndexPeek* and *IndexKeep* pages won't delete `TempData["Message"]`.</span></span>

<span data-ttu-id="c5809-275">次のコードでは `TempData["Message"]` が表示されますが、要求の最後に `TempData["Message"]` が削除されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-275">The following code displays `TempData["Message"]`, but at the end of the request, `TempData["Message"]` is deleted:</span></span>

[!code-cshtml[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/Index.cshtml?range=1-14)]

### <a name="tempdata-providers"></a><span data-ttu-id="c5809-276">TempData プロバイダー</span><span class="sxs-lookup"><span data-stu-id="c5809-276">TempData providers</span></span>

<span data-ttu-id="c5809-277">cookie に TempData を格納するには、既定では、cookie ベースの TempData プロバイダーが使われます。</span><span class="sxs-lookup"><span data-stu-id="c5809-277">The cookie-based TempData provider is used by default to store TempData in cookies.</span></span>

<span data-ttu-id="c5809-278">cookie データは、<xref:Microsoft.AspNetCore.DataProtection.IDataProtector> を使用して暗号化され、<xref:Microsoft.AspNetCore.WebUtilities.Base64UrlTextEncoder> でエンコードされた後、チャンクされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-278">The cookie data is encrypted using <xref:Microsoft.AspNetCore.DataProtection.IDataProtector>, encoded with <xref:Microsoft.AspNetCore.WebUtilities.Base64UrlTextEncoder>, then chunked.</span></span> <span data-ttu-id="c5809-279">cookie の最大サイズは、暗号化とチャンクのため、[4096](http://www.faqs.org/rfcs/rfc2965.html) バイト未満です。</span><span class="sxs-lookup"><span data-stu-id="c5809-279">The maximum cookie size is less than [4096 bytes](http://www.faqs.org/rfcs/rfc2965.html) due to encryption and chunking.</span></span> <span data-ttu-id="c5809-280">暗号化されているデータを圧縮すると、[CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) 攻撃や [BREACH](https://wikipedia.org/wiki/BREACH_(security_exploit)) 攻撃など、セキュリティ上の問題を起す可能性があるため、cookie データは圧縮されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-280">The cookie data isn't compressed because compressing encrypted data can lead to security problems such as the [CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) and [BREACH](https://wikipedia.org/wiki/BREACH_(security_exploit)) attacks.</span></span> <span data-ttu-id="c5809-281">cookie ベース TempData プロバイダーの詳細については、<xref:Microsoft.AspNetCore.Mvc.ViewFeatures.CookieTempDataProvider> に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-281">For more information on the cookie-based TempData provider, see <xref:Microsoft.AspNetCore.Mvc.ViewFeatures.CookieTempDataProvider>.</span></span>

### <a name="choose-a-tempdata-provider"></a><span data-ttu-id="c5809-282">TempData プロバイダーを選択する</span><span class="sxs-lookup"><span data-stu-id="c5809-282">Choose a TempData provider</span></span>

<span data-ttu-id="c5809-283">TempData プロバイダーを選択するときの考慮事項:</span><span class="sxs-lookup"><span data-stu-id="c5809-283">Choosing a TempData provider involves several considerations, such as:</span></span>

* <span data-ttu-id="c5809-284">アプリは既にセッション状態を使っているかどうか。</span><span class="sxs-lookup"><span data-stu-id="c5809-284">Does the app already use session state?</span></span> <span data-ttu-id="c5809-285">その場合、データのサイズを超えて、セッション状態 TempData プロバイダーがそのアプリにコストを追加することはありません。</span><span class="sxs-lookup"><span data-stu-id="c5809-285">If so, using the session state TempData provider has no additional cost to the app beyond the size of the data.</span></span>
* <span data-ttu-id="c5809-286">アプリでは、比較的少量のデータに対して (最大 500 バイト) TempData がわずかばかり使用されているか。</span><span class="sxs-lookup"><span data-stu-id="c5809-286">Does the app use TempData only sparingly for relatively small amounts of data, up to 500 bytes?</span></span> <span data-ttu-id="c5809-287">該当する場合、cookie TempData プロバイダーによって TempData を送信する要求ごとに少額のコストが追加されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-287">If so, the cookie TempData provider adds a small cost to each request that carries TempData.</span></span> <span data-ttu-id="c5809-288">該当しない場合、セッション状態 TempData プロバイダーは便利かもしれません。TempData が尽きるまで、要求のたびに大量のデータをラウンドトリップすることが回避されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-288">If not, the session state TempData provider can be beneficial to avoid round-tripping a large amount of data in each request until the TempData is consumed.</span></span>
* <span data-ttu-id="c5809-289">アプリは複数サーバーのサーバー ファームで実行しているか。</span><span class="sxs-lookup"><span data-stu-id="c5809-289">Does the app run in a server farm on multiple servers?</span></span> <span data-ttu-id="c5809-290">そうである場合は、データ保護の外部で cookie TempData プロバイダーを使用するために、追加の構成は必要ありません (「<xref:security/data-protection/introduction>」および[キー ストレージ プロバイダー](xref:security/data-protection/implementation/key-storage-providers)に関する記事を参照)。</span><span class="sxs-lookup"><span data-stu-id="c5809-290">If so, there's no additional configuration required to use the cookie TempData provider outside of Data Protection (see <xref:security/data-protection/introduction> and [Key storage providers](xref:security/data-protection/implementation/key-storage-providers)).</span></span>

<span data-ttu-id="c5809-291">Web ブラウザーなどのほとんどの Web クライアントによって、各 cookie の最大サイズと cookie の合計数に上限が設けられます。</span><span class="sxs-lookup"><span data-stu-id="c5809-291">Most web clients such as web browsers enforce limits on the maximum size of each cookie and the total number of cookies.</span></span> <span data-ttu-id="c5809-292">cookie TempData プロバイダーを使用するとき、アプリで[それらの上限](http://www.faqs.org/rfcs/rfc2965.html)が超えないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-292">When using the cookie TempData provider, verify the app won't exceed [these limits](http://www.faqs.org/rfcs/rfc2965.html).</span></span> <span data-ttu-id="c5809-293">データの合計サイズを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-293">Consider the total size of the data.</span></span> <span data-ttu-id="c5809-294">暗号化とチャンクによる cookie のサイズの増加を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-294">Account for increases in cookie size due to encryption and chunking.</span></span>

### <a name="configure-the-tempdata-provider"></a><span data-ttu-id="c5809-295">TempData プロバイダーを構成する</span><span class="sxs-lookup"><span data-stu-id="c5809-295">Configure the TempData provider</span></span>

<span data-ttu-id="c5809-296">cookie ベース TempData プロバイダーは既定で有効になります。</span><span class="sxs-lookup"><span data-stu-id="c5809-296">The cookie-based TempData provider is enabled by default.</span></span>

<span data-ttu-id="c5809-297">セッション ベースの TempData プロバイダーを有効にするには、<xref:Microsoft.Extensions.DependencyInjection.MvcViewFeaturesMvcBuilderExtensions.AddSessionStateTempDataProvider%2A> 拡張メソッドを使います。</span><span class="sxs-lookup"><span data-stu-id="c5809-297">To enable the session-based TempData provider, use the <xref:Microsoft.Extensions.DependencyInjection.MvcViewFeaturesMvcBuilderExtensions.AddSessionStateTempDataProvider%2A> extension method.</span></span> <span data-ttu-id="c5809-298">`AddSessionStateTempDataProvider` の呼び出しは 1 つだけ必要です。</span><span class="sxs-lookup"><span data-stu-id="c5809-298">Only one call to `AddSessionStateTempDataProvider` is required:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Startup3.cs?name=snippet1&highlight=4,6,8,30)]

## <a name="query-strings"></a><span data-ttu-id="c5809-299">クエリ文字列</span><span class="sxs-lookup"><span data-stu-id="c5809-299">Query strings</span></span>

<span data-ttu-id="c5809-300">限られた量のデータを要求間で渡すことができます。新しい要求のクエリ文字列にそれを追加します。</span><span class="sxs-lookup"><span data-stu-id="c5809-300">A limited amount of data can be passed from one request to another by adding it to the new request's query string.</span></span> <span data-ttu-id="c5809-301">これは、リンクと埋め込まれた状態がメールまたはソーシャル ネットワークを通して共有されるよう、永久的に状態をキャプチャするのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c5809-301">This is useful for capturing state in a persistent manner that allows links with embedded state to be shared through email or social networks.</span></span> <span data-ttu-id="c5809-302">URL クエリ文字列はパブリックであるため、機密データにはクエリ文字列を使わないでください。</span><span class="sxs-lookup"><span data-stu-id="c5809-302">Because URL query strings are public, never use query strings for sensitive data.</span></span>

<span data-ttu-id="c5809-303">意図しない共有に加えて、クエリ文字列にデータを含めると、アプリが[クロスサイト リクエスト フォージェリ (CSRF)](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)) 攻撃に晒される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-303">In addition to unintended sharing, including data in query strings can expose the app to [Cross-Site Request Forgery (CSRF)](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)) attacks.</span></span> <span data-ttu-id="c5809-304">保存されたセッション状態を CSRF 攻撃から保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-304">Any preserved session state must protect against CSRF attacks.</span></span> <span data-ttu-id="c5809-305">詳細については、「<xref:security/anti-request-forgery>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-305">For more information, see <xref:security/anti-request-forgery>.</span></span>

## <a name="hidden-fields"></a><span data-ttu-id="c5809-306">非表示フィールド</span><span class="sxs-lookup"><span data-stu-id="c5809-306">Hidden fields</span></span>

<span data-ttu-id="c5809-307">データは非表示フォーム フィールドに保存したり、次の要求で転記したりできます。</span><span class="sxs-lookup"><span data-stu-id="c5809-307">Data can be saved in hidden form fields and posted back on the next request.</span></span> <span data-ttu-id="c5809-308">複数ページ フォームでは、これは一般的です。</span><span class="sxs-lookup"><span data-stu-id="c5809-308">This is common in multi-page forms.</span></span> <span data-ttu-id="c5809-309">クライアントがデータを改ざんする可能性があるため、アプリで非表示フィールドに格納されているデータを常に再検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-309">Because the client can potentially tamper with the data, the app must always revalidate the data stored in hidden fields.</span></span>

## <a name="httpcontextitems"></a><span data-ttu-id="c5809-310">HttpContext.Items</span><span class="sxs-lookup"><span data-stu-id="c5809-310">HttpContext.Items</span></span>

<span data-ttu-id="c5809-311">1 つの要求を処理している間にデータを格納するには、<xref:Microsoft.AspNetCore.Http.HttpContext.Items?displayProperty=nameWithType> コレクションを使います。</span><span class="sxs-lookup"><span data-stu-id="c5809-311">The <xref:Microsoft.AspNetCore.Http.HttpContext.Items?displayProperty=nameWithType> collection is used to store data while processing a single request.</span></span> <span data-ttu-id="c5809-312">要求が処理された後、コレクションの内容は破棄されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-312">The collection's contents are discarded after a request is processed.</span></span> <span data-ttu-id="c5809-313">`Items` コレクションは、コンポーネントまたはミドルウェアが要求の間の異なる時点で動作し、パラメーターを受け渡す直接的な方法がない場合に、コンポーネントとミドルウェアが通信できるようにするためによく使われます。</span><span class="sxs-lookup"><span data-stu-id="c5809-313">The `Items` collection is often used to allow components or middleware to communicate when they operate at different points in time during a request and have no direct way to pass parameters.</span></span>

<span data-ttu-id="c5809-314">次の例では、[ミドルウェア](xref:fundamentals/middleware/index)により `isVerified` が `Items` コレクションに追加されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-314">In the following example, [middleware](xref:fundamentals/middleware/index) adds `isVerified` to the `Items` collection:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Startup.cs?name=snippet1)]

<span data-ttu-id="c5809-315">1 つのアプリでのみ使用されるミドルウェアの場合、固定の `string` キーを使用できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-315">For middleware that's only used in a single app, fixed `string` keys are acceptable.</span></span> <span data-ttu-id="c5809-316">アプリ間で共有されるミドルウェアでは、キーの競合を避けるため、一意のオブジェクト キーを使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-316">Middleware shared between apps should use unique object keys to avoid key collisions.</span></span> <span data-ttu-id="c5809-317">次の例では、ミドルウェア クラスで定義されている一意のオブジェクト キーを使用する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-317">The following example shows how to use a unique object key defined in a middleware class:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Middleware/HttpContextItemsMiddleware.cs?name=snippet1&highlight=4,13)]

<span data-ttu-id="c5809-318">その他のコードは、ミドルウェア クラスで公開されるキーを利用し、`HttpContext.Items` に格納されている値にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c5809-318">Other code can access the value stored in `HttpContext.Items` using the key exposed by the middleware class:</span></span>

[!code-csharp[](app-state/samples/3.x/SessionSample/Pages/Index.cshtml.cs?name=snippet3)]

<span data-ttu-id="c5809-319">この方法には、コード内でキーの文字列を使用する必要がないという利点もあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-319">This approach also has the advantage of eliminating the use of key strings in the code.</span></span>

## <a name="cache"></a><span data-ttu-id="c5809-320">キャッシュ</span><span class="sxs-lookup"><span data-stu-id="c5809-320">Cache</span></span>

<span data-ttu-id="c5809-321">キャッシュは、データを保存し、取得する効率的な方法です。</span><span class="sxs-lookup"><span data-stu-id="c5809-321">Caching is an efficient way to store and retrieve data.</span></span> <span data-ttu-id="c5809-322">アプリでは、キャッシュされた項目の有効期間を制御できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-322">The app can control the lifetime of cached items.</span></span> <span data-ttu-id="c5809-323">詳細については、「<xref:performance/caching/response>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-323">For more information, see <xref:performance/caching/response>.</span></span>

<span data-ttu-id="c5809-324">キャッシュされたデータは、特定の要求、ユーザー、またはセッションに関連付けられていません。</span><span class="sxs-lookup"><span data-stu-id="c5809-324">Cached data isn't associated with a specific request, user, or session.</span></span> <span data-ttu-id="c5809-325">**他のユーザーの要求によって取得される可能性があるので、ユーザー固有データをキャッシュしないでください。**</span><span class="sxs-lookup"><span data-stu-id="c5809-325">**Do not cache user-specific data that may be retrieved by other user requests.**</span></span>

<span data-ttu-id="c5809-326">アプリケーション全体のデータをキャッシュするには、「<xref:performance/caching/memory>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-326">To cache application wide data, see <xref:performance/caching/memory>.</span></span>

## <a name="common-errors"></a><span data-ttu-id="c5809-327">一般的なエラー</span><span class="sxs-lookup"><span data-stu-id="c5809-327">Common errors</span></span>

* <span data-ttu-id="c5809-328">"'Microsoft.AspNetCore.Session.DistributedSessionStore' を起動しようとしましたが、型 'Microsoft.Extensions.Caching.Distributed.IDistributedCache' のサービスを解決できません。"</span><span class="sxs-lookup"><span data-stu-id="c5809-328">"Unable to resolve service for type 'Microsoft.Extensions.Caching.Distributed.IDistributedCache' while attempting to activate 'Microsoft.AspNetCore.Session.DistributedSessionStore'."</span></span>

  <span data-ttu-id="c5809-329">これは通常、少なくとも 1 つの `IDistributedCache` 実装で構成に失敗したことで発生します。</span><span class="sxs-lookup"><span data-stu-id="c5809-329">This is typically caused by failing to configure at least one `IDistributedCache` implementation.</span></span> <span data-ttu-id="c5809-330">詳細については、次のトピックを参照してください。 <xref:performance/caching/distributed> および <xref:performance/caching/memory></span><span class="sxs-lookup"><span data-stu-id="c5809-330">For more information, see <xref:performance/caching/distributed> and <xref:performance/caching/memory>.</span></span>

<span data-ttu-id="c5809-331">セッション ミドルウェアがセッションを永続化できない場合:</span><span class="sxs-lookup"><span data-stu-id="c5809-331">If the session middleware fails to persist a session:</span></span>

* <span data-ttu-id="c5809-332">ミドルウェアは例外をログに記録し、要求は普通に続行されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-332">The middleware logs the exception and the request continues normally.</span></span>
* <span data-ttu-id="c5809-333">これにより、予期しない動作が発生します。</span><span class="sxs-lookup"><span data-stu-id="c5809-333">This leads to unpredictable behavior.</span></span>

<span data-ttu-id="c5809-334">バッキング ストアを利用できない場合、セッション ミドルウェアがセッションを永続化できないことがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-334">The session middleware can fail to persist a session if the backing store isn't available.</span></span> <span data-ttu-id="c5809-335">たとえば、ユーザーがセッションでショッピング カートを格納します。</span><span class="sxs-lookup"><span data-stu-id="c5809-335">For example, a user stores a shopping cart in session.</span></span> <span data-ttu-id="c5809-336">ユーザーはアイテムをカートに追加しますが、コミットが失敗します。</span><span class="sxs-lookup"><span data-stu-id="c5809-336">The user adds an item to the cart but the commit fails.</span></span> <span data-ttu-id="c5809-337">アプリはこの失敗を認識しないので、アイテムがカートに追加されたことをユーザーに伝えますが、これは正しくありません。</span><span class="sxs-lookup"><span data-stu-id="c5809-337">The app doesn't know about the failure so it reports to the user that the item was added to their cart, which isn't true.</span></span>

<span data-ttu-id="c5809-338">エラーを確認するための推奨される方法は、アプリがセッションへの書き込みを終了したら、`await feature.Session.CommitAsync` を呼び出すことです。</span><span class="sxs-lookup"><span data-stu-id="c5809-338">The recommended approach to check for errors is to call `await feature.Session.CommitAsync` when the app is done writing to the session.</span></span> <span data-ttu-id="c5809-339">バッキング ストアが利用できない場合、<xref:Microsoft.AspNetCore.Http.ISession.CommitAsync*> は例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="c5809-339"><xref:Microsoft.AspNetCore.Http.ISession.CommitAsync*> throws an exception if the backing store is unavailable.</span></span> <span data-ttu-id="c5809-340">`CommitAsync` が失敗した場合、アプリは例外を処理できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-340">If `CommitAsync` fails, the app can process the exception.</span></span> <span data-ttu-id="c5809-341"><xref:Microsoft.AspNetCore.Http.ISession.LoadAsync*> は、データ ストアが利用できない場合に同じ条件でスローします。</span><span class="sxs-lookup"><span data-stu-id="c5809-341"><xref:Microsoft.AspNetCore.Http.ISession.LoadAsync*> throws under the same conditions when the data store is unavailable.</span></span>
  
## <a name="no-locsignalr-and-session-state"></a><span data-ttu-id="c5809-342">SignalR とセッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-342">SignalR and session state</span></span>

<span data-ttu-id="c5809-343">SignalR アプリでは、セッション状態を使用して情報を格納することはできません。</span><span class="sxs-lookup"><span data-stu-id="c5809-343">SignalR apps should not use session state to store information.</span></span> <span data-ttu-id="c5809-344">SignalR アプリは、ハブ内の `Context.Items` に接続ごとの状態を格納できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-344">SignalR apps can store per connection state in `Context.Items` in the hub.</span></span> <!-- https://github.com/aspnet/SignalR/issues/2139 -->

## <a name="additional-resources"></a><span data-ttu-id="c5809-345">その他の技術情報</span><span class="sxs-lookup"><span data-stu-id="c5809-345">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="c5809-346">作成者: [Rick Anderson](https://twitter.com/RickAndMSFT)、[Steve Smith](https://ardalis.com/)、[Diana LaRose](https://github.com/DianaLaRose)、[Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="c5809-346">By [Rick Anderson](https://twitter.com/RickAndMSFT), [Steve Smith](https://ardalis.com/), [Diana LaRose](https://github.com/DianaLaRose), and [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="c5809-347">HTTP はステートレス プロトコルです。</span><span class="sxs-lookup"><span data-stu-id="c5809-347">HTTP is a stateless protocol.</span></span> <span data-ttu-id="c5809-348">手順を追加しないと、HTTP 要求は独立したメッセージであり、ユーザーの値やアプリの状態は保持されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-348">Without taking additional steps, HTTP requests are independent messages that don't retain user values or app state.</span></span> <span data-ttu-id="c5809-349">この記事では、要求と要求の間でユーザー データとアプリの状態を保持するための複数の方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c5809-349">This article describes several approaches to preserve user data and app state between requests.</span></span>

<span data-ttu-id="c5809-350">[サンプル コードを表示またはダウンロード](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/app-state/samples)します ([ダウンロード方法](xref:index#how-to-download-a-sample))。</span><span class="sxs-lookup"><span data-stu-id="c5809-350">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/app-state/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="state-management"></a><span data-ttu-id="c5809-351">状態管理</span><span class="sxs-lookup"><span data-stu-id="c5809-351">State management</span></span>

<span data-ttu-id="c5809-352">状態は、いくつかの方法で格納することができます。</span><span class="sxs-lookup"><span data-stu-id="c5809-352">State can be stored using several approaches.</span></span> <span data-ttu-id="c5809-353">このトピックではそれぞれの方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c5809-353">Each approach is described later in this topic.</span></span>

| <span data-ttu-id="c5809-354">格納の方法</span><span class="sxs-lookup"><span data-stu-id="c5809-354">Storage approach</span></span> | <span data-ttu-id="c5809-355">格納のメカニズム</span><span class="sxs-lookup"><span data-stu-id="c5809-355">Storage mechanism</span></span> |
| ---------------- | ----------------- |
| <span data-ttu-id="c5809-356">[Cookie ](#cookies)</span><span class="sxs-lookup"><span data-stu-id="c5809-356">[Cookies](#cookies)</span></span> | <span data-ttu-id="c5809-357">HTTP cookie (サーバー側アプリ コードを使って格納されたデータを含めることができます)</span><span class="sxs-lookup"><span data-stu-id="c5809-357">HTTP cookies (may include data stored using server-side app code)</span></span> |
| [<span data-ttu-id="c5809-358">セッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-358">Session state</span></span>](#session-state) | <span data-ttu-id="c5809-359">HTTP cookie とサーバー側アプリ コード</span><span class="sxs-lookup"><span data-stu-id="c5809-359">HTTP cookies and server-side app code</span></span> |
| [<span data-ttu-id="c5809-360">TempData</span><span class="sxs-lookup"><span data-stu-id="c5809-360">TempData</span></span>](#tempdata) | <span data-ttu-id="c5809-361">HTTP cookie またはセッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-361">HTTP cookies or session state</span></span> |
| [<span data-ttu-id="c5809-362">クエリ文字列</span><span class="sxs-lookup"><span data-stu-id="c5809-362">Query strings</span></span>](#query-strings) | <span data-ttu-id="c5809-363">HTTP クエリ文字列</span><span class="sxs-lookup"><span data-stu-id="c5809-363">HTTP query strings</span></span> |
| [<span data-ttu-id="c5809-364">非表示フィールド</span><span class="sxs-lookup"><span data-stu-id="c5809-364">Hidden fields</span></span>](#hidden-fields) | <span data-ttu-id="c5809-365">HTTP フォーム フィールド</span><span class="sxs-lookup"><span data-stu-id="c5809-365">HTTP form fields</span></span> |
| [<span data-ttu-id="c5809-366">HttpContext.Items</span><span class="sxs-lookup"><span data-stu-id="c5809-366">HttpContext.Items</span></span>](#httpcontextitems) | <span data-ttu-id="c5809-367">サーバー側アプリ コード</span><span class="sxs-lookup"><span data-stu-id="c5809-367">Server-side app code</span></span> |
| [<span data-ttu-id="c5809-368">キャッシュ</span><span class="sxs-lookup"><span data-stu-id="c5809-368">Cache</span></span>](#cache) | <span data-ttu-id="c5809-369">サーバー側アプリ コード</span><span class="sxs-lookup"><span data-stu-id="c5809-369">Server-side app code</span></span> |
| [<span data-ttu-id="c5809-370">依存性の注入</span><span class="sxs-lookup"><span data-stu-id="c5809-370">Dependency Injection</span></span>](#dependency-injection) | <span data-ttu-id="c5809-371">サーバー側アプリ コード</span><span class="sxs-lookup"><span data-stu-id="c5809-371">Server-side app code</span></span> |

## <a name="no-loccookies"></a><span data-ttu-id="c5809-372">Cookies</span><span class="sxs-lookup"><span data-stu-id="c5809-372">Cookies</span></span>

<span data-ttu-id="c5809-373">Cookie には、要求と要求の間でデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-373">Cookies store data across requests.</span></span> <span data-ttu-id="c5809-374">cookie は要求ごとに送信されるために、そのサイズは最小に抑える必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-374">Because cookies are sent with every request, their size should be kept to a minimum.</span></span> <span data-ttu-id="c5809-375">理想的には、識別子だけを cookie に格納し、データはアプリで格納します。</span><span class="sxs-lookup"><span data-stu-id="c5809-375">Ideally, only an identifier should be stored in a cookie with the data stored by the app.</span></span> <span data-ttu-id="c5809-376">ほとんどのブラウザーで cookie のサイズは 4096 バイトに制限されています。</span><span class="sxs-lookup"><span data-stu-id="c5809-376">Most browsers restrict cookie size to 4096 bytes.</span></span> <span data-ttu-id="c5809-377">ドメインごとに使用できる cookie の数も制限されています。</span><span class="sxs-lookup"><span data-stu-id="c5809-377">Only a limited number of cookies are available for each domain.</span></span>

<span data-ttu-id="c5809-378">cookie は改ざんされる可能性があるため、アプリで検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-378">Because cookies are subject to tampering, they must be validated by the app.</span></span> <span data-ttu-id="c5809-379">Cookie は、ユーザーが削除でき、クライアント上で期限切れになります。</span><span class="sxs-lookup"><span data-stu-id="c5809-379">Cookies can be deleted by users and expire on clients.</span></span> <span data-ttu-id="c5809-380">ただし、cookie は一般に、クライアントでデータを永続化するときに最も持続性のある形式です。</span><span class="sxs-lookup"><span data-stu-id="c5809-380">However, cookies are generally the most durable form of data persistence on the client.</span></span>

<span data-ttu-id="c5809-381">Cookie は、多くの場合、パーソナル化に利用されます。既知のユーザーのためにコンテンツをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="c5809-381">Cookies are often used for personalization, where content is customized for a known user.</span></span> <span data-ttu-id="c5809-382">ユーザーは識別されるだけであり、ほとんどの場合は認証されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-382">The user is only identified and not authenticated in most cases.</span></span> <span data-ttu-id="c5809-383">cookie には、ユーザーの名前、アカウント名、または一意のユーザー ID (GUID など) を格納できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-383">The cookie can store the user's name, account name, or unique user ID (such as a GUID).</span></span> <span data-ttu-id="c5809-384">その後は、優先される Web サイトの背景色など、ユーザーの個人用設定に cookie を使ってアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c5809-384">You can then use the cookie to access the user's personalized settings, such as their preferred website background color.</span></span>

<span data-ttu-id="c5809-385">cookie を発行し、プライバシーの問題を扱うときは、[欧州連合の一般データ保護規則 (GDPR)](https://ec.europa.eu/info/law/law-topic/data-protection) に留意してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-385">Be mindful of the [European Union General Data Protection Regulations (GDPR)](https://ec.europa.eu/info/law/law-topic/data-protection) when issuing cookies and dealing with privacy concerns.</span></span> <span data-ttu-id="c5809-386">詳細については、「[General Data Protection Regulation (GDPR) support in ASP.NET Core](xref:security/gdpr)」(ASP.NET Core での一般データ保護規則 (GDPR) のサポート) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c5809-386">For more information, see [General Data Protection Regulation (GDPR) support in ASP.NET Core](xref:security/gdpr).</span></span>

## <a name="session-state"></a><span data-ttu-id="c5809-387">セッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-387">Session state</span></span>

<span data-ttu-id="c5809-388">セッション状態は、ユーザーが Web アプリを参照している期間中ユーザー データを格納するための ASP.NET Core のシナリオです。</span><span class="sxs-lookup"><span data-stu-id="c5809-388">Session state is an ASP.NET Core scenario for storage of user data while the user browses a web app.</span></span> <span data-ttu-id="c5809-389">セッション状態では、アプリで管理されているストアを使用して、クライアントからの要求間でデータを保持します。</span><span class="sxs-lookup"><span data-stu-id="c5809-389">Session state uses a store maintained by the app to persist data across requests from a client.</span></span> <span data-ttu-id="c5809-390">セッション データはキャッシュによってバックアップされ、一時的なデータと見なされます。セッション データがなくても、サイトは機能し続けられる必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-390">The session data is backed by a cache and considered ephemeral data&mdash;the site should continue to function without the session data.</span></span> <span data-ttu-id="c5809-391">重要なアプリケーションのデータはユーザー データベースに格納し、パフォーマンスの最適化としてのみセッションでキャッシュする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-391">Critical application data should be stored in the user database and cached in session only as a performance optimization.</span></span>

> [!NOTE]
> <span data-ttu-id="c5809-392">[SignalR ハブ](xref:signalr/hubs)は HTTP コンテキストとは独立して実行する可能性があるため、[SignalR](xref:signalr/index) アプリではセッションはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="c5809-392">Session isn't supported in [SignalR](xref:signalr/index) apps because a [SignalR Hub](xref:signalr/hubs) may execute independent of an HTTP context.</span></span> <span data-ttu-id="c5809-393">このようなことは、たとえば、長いポーリング要求が HTTP コンテキストの有効期間を超えてハブによって開かれている場合に発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-393">For example, this can occur when a long polling request is held open by a hub beyond the lifetime of the request's HTTP context.</span></span>

<span data-ttu-id="c5809-394">ASP.NET Core は、セッション ID を含み、要求ごとに各アプリに送信される cookie がクライアントに提供されて、セッションの状態が維持されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-394">ASP.NET Core maintains session state by providing a cookie to the client that contains a session ID, which is sent to the app with each request.</span></span> <span data-ttu-id="c5809-395">アプリは、セッション ID を使用してセッション データをフェッチします。</span><span class="sxs-lookup"><span data-stu-id="c5809-395">The app uses the session ID to fetch the session data.</span></span>

<span data-ttu-id="c5809-396">セッション状態は次の動作を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-396">Session state exhibits the following behaviors:</span></span>

* <span data-ttu-id="c5809-397">セッション cookie はブラウザーに固有であるため、セッションはブラウザー間では共有されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-397">Because the session cookie is specific to the browser, sessions aren't shared across browsers.</span></span>
* <span data-ttu-id="c5809-398">セッション cookie は、ブラウザー セッションが終了するときに削除されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-398">Session cookies are deleted when the browser session ends.</span></span>
* <span data-ttu-id="c5809-399">cookie を受け取り、セッションが期限切れになった場合、同じセッション cookie を使用する新しいセッションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-399">If a cookie is received for an expired session, a new session is created that uses the same session cookie.</span></span>
* <span data-ttu-id="c5809-400">空のセッションは保持されません。要求と要求の間でセッションを維持するには、少なくとも 1 つの値をセッションが持っている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-400">Empty sessions aren't retained&mdash;the session must have at least one value set into it to persist the session across requests.</span></span> <span data-ttu-id="c5809-401">セッションが保持されないと、新しい要求ごとに新しいセッション ID が生成されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-401">When a session isn't retained, a new session ID is generated for each new request.</span></span>
* <span data-ttu-id="c5809-402">アプリは、最後の要求から限られた時間だけセッションを維持します。</span><span class="sxs-lookup"><span data-stu-id="c5809-402">The app retains a session for a limited time after the last request.</span></span> <span data-ttu-id="c5809-403">アプリでは、セッション タイムアウトを設定するか、既定値の 20 分を使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-403">The app either sets the session timeout or uses the default value of 20 minutes.</span></span> <span data-ttu-id="c5809-404">セッション状態は、特定のセッションに固有であるが、セッション間で永続的に保持する必要のないユーザー データの格納に最適です。</span><span class="sxs-lookup"><span data-stu-id="c5809-404">Session state is ideal for storing user data that's specific to a particular session but where the data doesn't require permanent storage across sessions.</span></span>
* <span data-ttu-id="c5809-405">セッション データは、<xref:Microsoft.AspNetCore.Http.ISession.Clear%2A?displayProperty=nameWithType> の実装が呼び出されるか、セッションが期限切れになると、削除されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-405">Session data is deleted either when the <xref:Microsoft.AspNetCore.Http.ISession.Clear%2A?displayProperty=nameWithType> implementation is called or when the session expires.</span></span>
* <span data-ttu-id="c5809-406">クライアント ブラウザーが閉じられたこと、またはクライアントでセッション cookie が削除されるか期限切れになったことを、アプリ コードに通知する既定のメカニズムはありません。</span><span class="sxs-lookup"><span data-stu-id="c5809-406">There's no default mechanism to inform app code that a client browser has been closed or when the session cookie is deleted or expired on the client.</span></span>
* <span data-ttu-id="c5809-407">ASP.NET Core MVC と Razor ページのテンプレートには、一般データ保護規制 (GDPR) のサポートが含まれます。</span><span class="sxs-lookup"><span data-stu-id="c5809-407">The ASP.NET Core MVC and Razor pages templates include support for General Data Protection Regulation (GDPR).</span></span> <span data-ttu-id="c5809-408">セッション状態の cookie は既定では必須になっていません。このため、サイトの訪問者が追跡を許可しない限り、セッション状態は機能しません。</span><span class="sxs-lookup"><span data-stu-id="c5809-408">Session state cookies aren't marked essential by default, so session state isn't functional unless tracking is permitted by the site visitor.</span></span> <span data-ttu-id="c5809-409">詳細については、「<xref:security/gdpr#tempdata-provider-and-session-state-cookies-arent-essential>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-409">For more information, see <xref:security/gdpr#tempdata-provider-and-session-state-cookies-arent-essential>.</span></span>

> [!WARNING]
> <span data-ttu-id="c5809-410">セッション状態には機密データを保存しないでください。</span><span class="sxs-lookup"><span data-stu-id="c5809-410">Don't store sensitive data in session state.</span></span> <span data-ttu-id="c5809-411">ユーザーがブラウザーを閉じず、セッション cookie がクリアされない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-411">The user might not close the browser and clear the session cookie.</span></span> <span data-ttu-id="c5809-412">一部のブラウザーでは、ブラウザーのウィンドウ間で有効なセッションの cookie が維持されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-412">Some browsers maintain valid session cookies across browser windows.</span></span> <span data-ttu-id="c5809-413">セッションが 1 人のユーザーに制限されず&mdash;次のユーザーが同じセッション cookie でアプリの閲覧を続けることがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-413">A session might not be restricted to a single user&mdash;the next user might continue to browse the app with the same session cookie.</span></span>

<span data-ttu-id="c5809-414">メモリ内キャッシュ プロバイダーは、アプリが存在するサーバーのメモリにセッション データを格納します。</span><span class="sxs-lookup"><span data-stu-id="c5809-414">The in-memory cache provider stores session data in the memory of the server where the app resides.</span></span> <span data-ttu-id="c5809-415">サーバー ファームのシナリオでは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c5809-415">In a server farm scenario:</span></span>

* <span data-ttu-id="c5809-416">"*固定セッション*" を使用して、個々のサーバー上の特定のアプリのインスタンスに、各セッションを結び付けます。</span><span class="sxs-lookup"><span data-stu-id="c5809-416">Use *sticky sessions* to tie each session to a specific app instance on an individual server.</span></span> <span data-ttu-id="c5809-417">[Azure App Service](https://azure.microsoft.com/services/app-service/) は[アプリケーション要求ルーティング処理 (ARR)](/iis/extensions/planning-for-arr/using-the-application-request-routing-module) を使って、既定で固定セッションを強制的に使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-417">[Azure App Service](https://azure.microsoft.com/services/app-service/) uses [Application Request Routing (ARR)](/iis/extensions/planning-for-arr/using-the-application-request-routing-module) to enforce sticky sessions by default.</span></span> <span data-ttu-id="c5809-418">ただし、固定セッションは拡張性に影響を与え、Web アプリの更新を複雑にすることがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-418">However, sticky sessions can affect scalability and complicate web app updates.</span></span> <span data-ttu-id="c5809-419">もっとよい方法は、Redis または SQL Server の分散キャッシュを使用することで、固定セッションを必要としません。</span><span class="sxs-lookup"><span data-stu-id="c5809-419">A better approach is to use a Redis or SQL Server distributed cache, which doesn't require sticky sessions.</span></span> <span data-ttu-id="c5809-420">詳細については、「<xref:performance/caching/distributed>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-420">For more information, see <xref:performance/caching/distributed>.</span></span>
* <span data-ttu-id="c5809-421">セッション cookie は <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> によって暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-421">The session cookie is encrypted via <xref:Microsoft.AspNetCore.DataProtection.IDataProtector>.</span></span> <span data-ttu-id="c5809-422">各コンピューターでセッション cookie が読み取られるようにするには、データ保護を適切に構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-422">Data Protection must be properly configured to read session cookies on each machine.</span></span> <span data-ttu-id="c5809-423">詳細については、<xref:security/data-protection/introduction> および[キー ストレージ プロバイダー](xref:security/data-protection/implementation/key-storage-providers)に関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c5809-423">For more information, see <xref:security/data-protection/introduction> and [Key storage providers](xref:security/data-protection/implementation/key-storage-providers).</span></span>

### <a name="configure-session-state"></a><span data-ttu-id="c5809-424">セッション状態を構成する</span><span class="sxs-lookup"><span data-stu-id="c5809-424">Configure session state</span></span>

<span data-ttu-id="c5809-425">[Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) に含まれる [Microsoft.AspNetCore.Session](https://www.nuget.org/packages/Microsoft.AspNetCore.Session/) パッケージは、セッション状態を管理するためのミドルウェアを提供します。</span><span class="sxs-lookup"><span data-stu-id="c5809-425">The [Microsoft.AspNetCore.Session](https://www.nuget.org/packages/Microsoft.AspNetCore.Session/) package, which is included in the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app), provides middleware for managing session state.</span></span> <span data-ttu-id="c5809-426">セッション ミドルウェアを有効にするには、`Startup` に次が含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-426">To enable the session middleware, `Startup` must contain:</span></span>

* <span data-ttu-id="c5809-427">いずれかの <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> メモリ キャッシュ。</span><span class="sxs-lookup"><span data-stu-id="c5809-427">Any of the <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> memory caches.</span></span> <span data-ttu-id="c5809-428">`IDistributedCache` 実装はセッションのバックアップ ストアとして利用されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-428">The `IDistributedCache` implementation is used as a backing store for session.</span></span> <span data-ttu-id="c5809-429">詳細については、「<xref:performance/caching/distributed>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-429">For more information, see <xref:performance/caching/distributed>.</span></span>
* <span data-ttu-id="c5809-430">`ConfigureServices` での <xref:Microsoft.Extensions.DependencyInjection.SessionServiceCollectionExtensions.AddSession%2A> の呼び出し。</span><span class="sxs-lookup"><span data-stu-id="c5809-430">A call to <xref:Microsoft.Extensions.DependencyInjection.SessionServiceCollectionExtensions.AddSession%2A> in `ConfigureServices`.</span></span>
* <span data-ttu-id="c5809-431">`Configure` での <xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession%2A> の呼び出し。</span><span class="sxs-lookup"><span data-stu-id="c5809-431">A call to <xref:Microsoft.AspNetCore.Builder.SessionMiddlewareExtensions.UseSession%2A> in `Configure`.</span></span>

<span data-ttu-id="c5809-432">次のコードでは、`IDistributedCache` の既定のメモリ内実装でメモリ内セッション プロバイダーを設定する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-432">The following code shows how to set up the in-memory session provider with a default in-memory implementation of `IDistributedCache`:</span></span>

[!code-csharp[](app-state/samples/2.x/SessionSample/Startup.cs?name=snippet1&highlight=5-14,34)]

<span data-ttu-id="c5809-433">ミドルウェアの順序が重要です。</span><span class="sxs-lookup"><span data-stu-id="c5809-433">The order of middleware is important.</span></span> <span data-ttu-id="c5809-434">上の例では、`UseMvc` の後で `UseSession` を呼び出すと、`InvalidOperationException` 例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="c5809-434">In the preceding example, an `InvalidOperationException` exception occurs when `UseSession` is invoked after `UseMvc`.</span></span> <span data-ttu-id="c5809-435">詳細については、[ミドルウェアの順序](xref:fundamentals/middleware/index#order)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c5809-435">For more information, see [Middleware Ordering](xref:fundamentals/middleware/index#order).</span></span>

<span data-ttu-id="c5809-436"><xref:Microsoft.AspNetCore.Http.HttpContext.Session?displayProperty=nameWithType> は、セッション状態を構成した後に使用できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-436"><xref:Microsoft.AspNetCore.Http.HttpContext.Session?displayProperty=nameWithType> is available after session state is configured.</span></span>

<span data-ttu-id="c5809-437">`UseSession` を呼び出前に `HttpContext.Session` にアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="c5809-437">`HttpContext.Session` can't be accessed before `UseSession` has been called.</span></span>

<span data-ttu-id="c5809-438">アプリが応答ストリームへの書き込みを開始した後では、新しいセッション cookie を含む新しいセッションを作成できません。</span><span class="sxs-lookup"><span data-stu-id="c5809-438">A new session with a new session cookie can't be created after the app has begun writing to the response stream.</span></span> <span data-ttu-id="c5809-439">例外は Web サーバー ログに記録され、ブラウザーには表示されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-439">The exception is recorded in the web server log and not displayed in the browser.</span></span>

### <a name="load-session-state-asynchronously"></a><span data-ttu-id="c5809-440">セッション状態を非同期的に読み込む</span><span class="sxs-lookup"><span data-stu-id="c5809-440">Load session state asynchronously</span></span>

<span data-ttu-id="c5809-441">ASP.NET Core の既定のセッション プロバイダーでは、<xref:Microsoft.AspNetCore.Http.ISession.TryGetValue%2A>、<xref:Microsoft.AspNetCore.Http.ISession.Set%2A>、または <xref:Microsoft.AspNetCore.Http.ISession.Remove%2A> メソッドの前に <xref:Microsoft.AspNetCore.Http.ISession.LoadAsync%2A?displayProperty=nameWithType> メソッドが明示的に呼び出された場合にのみ、基になる <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> バッキング ストアから非同期的にセッション レコードを読み込みます。</span><span class="sxs-lookup"><span data-stu-id="c5809-441">The default session provider in ASP.NET Core loads session records from the underlying <xref:Microsoft.Extensions.Caching.Distributed.IDistributedCache> backing store asynchronously only if the <xref:Microsoft.AspNetCore.Http.ISession.LoadAsync%2A?displayProperty=nameWithType> method is explicitly called before the <xref:Microsoft.AspNetCore.Http.ISession.TryGetValue%2A>, <xref:Microsoft.AspNetCore.Http.ISession.Set%2A>, or <xref:Microsoft.AspNetCore.Http.ISession.Remove%2A> methods.</span></span> <span data-ttu-id="c5809-442">`LoadAsync` を最初に呼び出さないと、基になっているセッション レコードは同期的に読み込まれ、パフォーマンスが大幅に低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-442">If `LoadAsync` isn't called first, the underlying session record is loaded synchronously, which can incur a performance penalty at scale.</span></span>

<span data-ttu-id="c5809-443">アプリにこのパターンを強制させるには、`TryGetValue`、`Set`、または `Remove` の前に `LoadAsync` メソッドが呼び出されない場合に例外をスローするバージョンで、<xref:Microsoft.AspNetCore.Session.DistributedSessionStore> および <xref:Microsoft.AspNetCore.Session.DistributedSession> の実装をラップします。</span><span class="sxs-lookup"><span data-stu-id="c5809-443">To have apps enforce this pattern, wrap the <xref:Microsoft.AspNetCore.Session.DistributedSessionStore> and <xref:Microsoft.AspNetCore.Session.DistributedSession> implementations with versions that throw an exception if the `LoadAsync` method isn't called before `TryGetValue`, `Set`, or `Remove`.</span></span> <span data-ttu-id="c5809-444">ラップしたバージョンをサービス コンテナーに登録します。</span><span class="sxs-lookup"><span data-stu-id="c5809-444">Register the wrapped versions in the services container.</span></span>

### <a name="session-options"></a><span data-ttu-id="c5809-445">セッション オプション</span><span class="sxs-lookup"><span data-stu-id="c5809-445">Session options</span></span>

<span data-ttu-id="c5809-446">セッションの既定値をオーバーライドするには、<xref:Microsoft.AspNetCore.Builder.SessionOptions> を使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-446">To override session defaults, use <xref:Microsoft.AspNetCore.Builder.SessionOptions>.</span></span>

| <span data-ttu-id="c5809-447">オプション</span><span class="sxs-lookup"><span data-stu-id="c5809-447">Option</span></span> | <span data-ttu-id="c5809-448">説明</span><span class="sxs-lookup"><span data-stu-id="c5809-448">Description</span></span> |
| ------ | ----------- |
| <xref:Microsoft.AspNetCore.Builder.SessionOptions.Cookie> | <span data-ttu-id="c5809-449">cookie の作成に使用される設定を決定します。</span><span class="sxs-lookup"><span data-stu-id="c5809-449">Determines the settings used to create the cookie.</span></span> <span data-ttu-id="c5809-450"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Name> の既定値は <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookieName?displayProperty=nameWithType> (`.AspNetCore.Session`) です。</span><span class="sxs-lookup"><span data-stu-id="c5809-450"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Name> defaults to <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookieName?displayProperty=nameWithType> (`.AspNetCore.Session`).</span></span> <span data-ttu-id="c5809-451"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Path> の既定値は <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookiePath?displayProperty=nameWithType> (`/`) です。</span><span class="sxs-lookup"><span data-stu-id="c5809-451"><xref:Microsoft.AspNetCore.Http.CookieBuilder.Path> defaults to <xref:Microsoft.AspNetCore.Session.SessionDefaults.CookiePath?displayProperty=nameWithType> (`/`).</span></span> <span data-ttu-id="c5809-452"><xref:Microsoft.AspNetCore.Http.CookieBuilder.SameSite> の既定値は <xref:Microsoft.AspNetCore.Http.SameSiteMode.Lax?displayProperty=nameWithType> (`1`) です。</span><span class="sxs-lookup"><span data-stu-id="c5809-452"><xref:Microsoft.AspNetCore.Http.CookieBuilder.SameSite> defaults to <xref:Microsoft.AspNetCore.Http.SameSiteMode.Lax?displayProperty=nameWithType> (`1`).</span></span> <span data-ttu-id="c5809-453"><xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> では、既定値が `true` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-453"><xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> defaults to `true`.</span></span> <span data-ttu-id="c5809-454"><xref:Microsoft.AspNetCore.Http.CookieBuilder.IsEssential> では、既定値が `false` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-454"><xref:Microsoft.AspNetCore.Http.CookieBuilder.IsEssential> defaults to `false`.</span></span> |
| <xref:Microsoft.AspNetCore.Builder.SessionOptions.IdleTimeout> | <span data-ttu-id="c5809-455">`IdleTimeout` は、内容を破棄されることなくセッションがアイドル状態になっていることのできる最大時間を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-455">The `IdleTimeout` indicates how long the session can be idle before its contents are abandoned.</span></span> <span data-ttu-id="c5809-456">セッションへのアクセスがあるたびに、タイムアウトはリセットされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-456">Each session access resets the timeout.</span></span> <span data-ttu-id="c5809-457">この設定はセッションの内容にのみ適用され、cookie には適用されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-457">This setting only applies to the content of the session, not the cookie.</span></span> <span data-ttu-id="c5809-458">既定値は 20 分です。</span><span class="sxs-lookup"><span data-stu-id="c5809-458">The default is 20 minutes.</span></span> |
| <xref:Microsoft.AspNetCore.Builder.SessionOptions.IOTimeout> | <span data-ttu-id="c5809-459">ストアからのセッションの読み込み、またはストアに戻すコミットに対して許容される最大時間です。</span><span class="sxs-lookup"><span data-stu-id="c5809-459">The maximum amount of time allowed to load a session from the store or to commit it back to the store.</span></span> <span data-ttu-id="c5809-460">この設定は非同期操作にのみ適用できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-460">This setting may only apply to asynchronous operations.</span></span> <span data-ttu-id="c5809-461">このタイムアウトは、<xref:System.Threading.Timeout.InfiniteTimeSpan> を使用して無効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="c5809-461">This timeout can be disabled using <xref:System.Threading.Timeout.InfiniteTimeSpan>.</span></span> <span data-ttu-id="c5809-462">既定値は 1 分です。</span><span class="sxs-lookup"><span data-stu-id="c5809-462">The default is 1 minute.</span></span> |

<span data-ttu-id="c5809-463">セッションは cookie を利用し、1 つのブラウザーからの要求を追跡し、識別します。</span><span class="sxs-lookup"><span data-stu-id="c5809-463">Session uses a cookie to track and identify requests from a single browser.</span></span> <span data-ttu-id="c5809-464">既定では、この cookie は `.AspNetCore.Session` という名前であり、パス `/` が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-464">By default, this cookie is named `.AspNetCore.Session`, and it uses a path of `/`.</span></span> <span data-ttu-id="c5809-465">cookie の既定値ではドメインが指定されないため、ページのクライアント側スクリプトには使用できません (<xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> の既定値が `true` になるため)。</span><span class="sxs-lookup"><span data-stu-id="c5809-465">Because the cookie default doesn't specify a domain, it isn't made available to the client-side script on the page (because <xref:Microsoft.AspNetCore.Http.CookieBuilder.HttpOnly> defaults to `true`).</span></span>

<span data-ttu-id="c5809-466">cookie セッションの既定値をオーバーライドするには、`SessionOptions` を使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-466">To override cookie session defaults, use `SessionOptions`:</span></span>

[!code-csharp[](app-state/samples_snapshot/2.x/SessionSample/Startup.cs?name=snippet1&highlight=14-19)]

<span data-ttu-id="c5809-467">アプリでは、<xref:Microsoft.AspNetCore.Builder.SessionOptions.IdleTimeout> プロパティを使用して、サーバーのキャッシュ内の内容が破棄されるまでのセッションのアイドル時間が決定されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-467">The app uses the <xref:Microsoft.AspNetCore.Builder.SessionOptions.IdleTimeout> property to determine how long a session can be idle before its contents in the server's cache are abandoned.</span></span> <span data-ttu-id="c5809-468">このプロパティは cookie の有効期限に依存しません。</span><span class="sxs-lookup"><span data-stu-id="c5809-468">This property is independent of the cookie expiration.</span></span> <span data-ttu-id="c5809-469">要求が[セッション ミドルウェア](xref:Microsoft.AspNetCore.Session.SessionMiddleware)を通過するたびにタイムアウトがリセットされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-469">Each request that passes through the [Session Middleware](xref:Microsoft.AspNetCore.Session.SessionMiddleware) resets the timeout.</span></span>

<span data-ttu-id="c5809-470">セッション状態は "*ロックなし*" です。</span><span class="sxs-lookup"><span data-stu-id="c5809-470">Session state is *non-locking*.</span></span> <span data-ttu-id="c5809-471">2 つの要求がセッションの内容を同時に変更しようとした場合、最後の要求が最初の要求をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="c5809-471">If two requests simultaneously attempt to modify the contents of a session, the last request overrides the first.</span></span> <span data-ttu-id="c5809-472">`Session` は*一貫性のあるセッション*として実装されます。つまり、コンテンツは全部まとめて保管されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-472">`Session` is implemented as a *coherent session*, which means that all the contents are stored together.</span></span> <span data-ttu-id="c5809-473">2 つの要求が異なるセッション値を変更しようとしたとき、最後の要求が最初の要求によって行われたセッションの変更をオーバーライドすることがあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-473">When two requests seek to modify different session values, the last request may override session changes made by the first.</span></span>

### <a name="set-and-get-session-values"></a><span data-ttu-id="c5809-474">セッション値の設定および取得</span><span class="sxs-lookup"><span data-stu-id="c5809-474">Set and get Session values</span></span>

<span data-ttu-id="c5809-475">セッション状態にアクセスするには、Razor Pages の <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel> クラスか、MVC の <xref:Microsoft.AspNetCore.Mvc.Controller> クラスを <xref:Microsoft.AspNetCore.Http.HttpContext.Session?displayProperty=nameWithType> と共に使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-475">Session state is accessed from a Razor Pages <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel> class or MVC <xref:Microsoft.AspNetCore.Mvc.Controller> class with <xref:Microsoft.AspNetCore.Http.HttpContext.Session?displayProperty=nameWithType>.</span></span> <span data-ttu-id="c5809-476">このプロパティは <xref:Microsoft.AspNetCore.Http.ISession> の実装です。</span><span class="sxs-lookup"><span data-stu-id="c5809-476">This property is an <xref:Microsoft.AspNetCore.Http.ISession> implementation.</span></span>

<span data-ttu-id="c5809-477">`ISession` の実装では、整数値や文字列値を設定および取得するための複数の拡張メソッドが提供されています。</span><span class="sxs-lookup"><span data-stu-id="c5809-477">The `ISession` implementation provides several extension methods to set and retrieve integer and string values.</span></span> <span data-ttu-id="c5809-478">[Microsoft.AspNetCore.Http.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.Http.Extensions/) パッケージがプロジェクトによって参照されている場合、拡張メソッドは <xref:Microsoft.AspNetCore.Http> 名前空間内にあります (拡張メソッドにアクセスするには、`using Microsoft.AspNetCore.Http;` ステートメントを追加します)。</span><span class="sxs-lookup"><span data-stu-id="c5809-478">The extension methods are in the <xref:Microsoft.AspNetCore.Http> namespace (add a `using Microsoft.AspNetCore.Http;` statement to gain access to the extension methods) when the [Microsoft.AspNetCore.Http.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.Http.Extensions/) package is referenced by the project.</span></span> <span data-ttu-id="c5809-479">どちらのパッケージも、[Microsoft.AspNetCore.App メタパッケージ](xref:fundamentals/metapackage-app)に含まれます。</span><span class="sxs-lookup"><span data-stu-id="c5809-479">Both packages are included in the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span></span>

<span data-ttu-id="c5809-480">`ISession` 拡張メソッド:</span><span class="sxs-lookup"><span data-stu-id="c5809-480">`ISession` extension methods:</span></span>

* [<span data-ttu-id="c5809-481">Get(ISession, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-481">Get(ISession, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.Get%2A)
* [<span data-ttu-id="c5809-482">GetInt32(ISession, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-482">GetInt32(ISession, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.GetInt32%2A)
* [<span data-ttu-id="c5809-483">GetString(ISession, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-483">GetString(ISession, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.GetString%2A)
* [<span data-ttu-id="c5809-484">SetInt32(ISession, String, Int32)</span><span class="sxs-lookup"><span data-stu-id="c5809-484">SetInt32(ISession, String, Int32)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.SetInt32%2A)
* [<span data-ttu-id="c5809-485">SetString(ISession, String, String)</span><span class="sxs-lookup"><span data-stu-id="c5809-485">SetString(ISession, String, String)</span></span>](xref:Microsoft.AspNetCore.Http.SessionExtensions.SetString%2A)

<span data-ttu-id="c5809-486">次の例では、`IndexModel.SessionKeyName` キー (サンプル アプリ内の `_Name`) のセッション値を Razor Pages ページで取得します。</span><span class="sxs-lookup"><span data-stu-id="c5809-486">The following example retrieves the session value for the `IndexModel.SessionKeyName` key (`_Name` in the sample app) in a Razor Pages page:</span></span>

```csharp
@page
@using Microsoft.AspNetCore.Http
@model IndexModel

...

Name: @HttpContext.Session.GetString(IndexModel.SessionKeyName)
```

<span data-ttu-id="c5809-487">次の例では、整数および文字列を設定および取得する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-487">The following example shows how to set and get an integer and a string:</span></span>

[!code-csharp[](app-state/samples/2.x/SessionSample/Pages/Index.cshtml.cs?name=snippet1&highlight=18-19,22-23)]

<span data-ttu-id="c5809-488">分散キャッシュのシナリオを有効にするには、メモリ内キャッシュを使用する場合であっても、すべてのセッション データをシリアル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-488">All session data must be serialized to enable a distributed cache scenario, even when using the in-memory cache.</span></span> <span data-ttu-id="c5809-489">文字列と整数のシリアライザーは、<xref:Microsoft.AspNetCore.Http.ISession>) の拡張メソッドによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-489">String and integer serializers are provided by the extension methods of <xref:Microsoft.AspNetCore.Http.ISession>).</span></span> <span data-ttu-id="c5809-490">複合型は、JSON などの別のメカニズムを使ってユーザーがシリアル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-490">Complex types must be serialized by the user using another mechanism, such as JSON.</span></span>

<span data-ttu-id="c5809-491">シリアル化可能なオブジェクトを設定および取得するには、次の拡張メソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="c5809-491">Add the following extension methods to set and get serializable objects:</span></span>

[!code-csharp[](app-state/samples/2.x/SessionSample/Extensions/SessionExtensions.cs?name=snippet1)]

<span data-ttu-id="c5809-492">次の例では、シリアル化可能オブジェクトを拡張メソッドで設定および取得する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-492">The following example shows how to set and get a serializable object with the extension methods:</span></span>

[!code-csharp[](app-state/samples/2.x/SessionSample/Pages/Index.cshtml.cs?name=snippet2)]

## <a name="tempdata"></a><span data-ttu-id="c5809-493">TempData</span><span class="sxs-lookup"><span data-stu-id="c5809-493">TempData</span></span>

<span data-ttu-id="c5809-494">ASP.NET Core によって、Razor Pages [TempData](xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel.TempData) または Controller <xref:Microsoft.AspNetCore.Mvc.Controller.TempData> が発行されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-494">ASP.NET Core exposes the Razor Pages [TempData](xref:Microsoft.AspNetCore.Mvc.RazorPages.PageModel.TempData) or Controller <xref:Microsoft.AspNetCore.Mvc.Controller.TempData>.</span></span> <span data-ttu-id="c5809-495">このプロパティには、別の要求で読み取られるまでデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-495">This property stores data until it's read in another request.</span></span> <span data-ttu-id="c5809-496">[Keep (String)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) メソッドと [Peek (String)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Peek*) メソッドを使用すると、要求の最後に削除せずにデータを調べることができます。</span><span class="sxs-lookup"><span data-stu-id="c5809-496">[Keep(String)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) and [Peek(string)](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Peek*) methods can be used to examine the data without deletion at the end of the request.</span></span> <span data-ttu-id="c5809-497">[Keep()](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) によって、リテンション期間についてディクショナリ内のすべての項目がマークされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-497">[Keep()](xref:Microsoft.AspNetCore.Mvc.ViewFeatures.ITempDataDictionary.Keep*) marks all items in the dictionary for retention.</span></span> <span data-ttu-id="c5809-498">`TempData` は特に、複数の要求にデータが必要な場合のリダイレクトに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c5809-498">`TempData` is particularly useful for redirection when data is required for more than a single request.</span></span> <span data-ttu-id="c5809-499">`TempData` は、`TempData` プロバイダーによって cookie またはセッション状態を使用して実装されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-499">`TempData` is implemented by `TempData` providers using either cookies or session state.</span></span>

## <a name="tempdata-samples"></a><span data-ttu-id="c5809-500">TempData のサンプル</span><span class="sxs-lookup"><span data-stu-id="c5809-500">TempData samples</span></span>

<span data-ttu-id="c5809-501">顧客を作成する次のページについて考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="c5809-501">Consider the following page that creates a customer:</span></span>

[!code-csharp[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/Create.cshtml.cs?name=snippet&highlight=15-16,30)]

<span data-ttu-id="c5809-502">次のページに `TempData["Message"]` が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-502">The following page displays `TempData["Message"]`:</span></span>

[!code-cshtml[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/IndexPeek.cshtml?range=1-14)]

<span data-ttu-id="c5809-503">前のマークアップでは、`Peek` が使用されているため、要求の最後に `TempData["Message"]` が削除**されません**。</span><span class="sxs-lookup"><span data-stu-id="c5809-503">In the preceding markup, at the end of the request, `TempData["Message"]` is **not** deleted because `Peek` is used.</span></span> <span data-ttu-id="c5809-504">ページを更新すると `TempData["Message"]` が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-504">Refreshing the page displays `TempData["Message"]`.</span></span>

<span data-ttu-id="c5809-505">次のマークアップは前のコードと似ていますが、`Keep` を使用して要求の最後にデータを保存しています。</span><span class="sxs-lookup"><span data-stu-id="c5809-505">The following markup is similar to the preceding code, but uses `Keep` to preserve the data at the end of the request:</span></span>

[!code-cshtml[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/IndexKeep.cshtml?range=1-14)]

<span data-ttu-id="c5809-506">*Indexpeek* ページと *IndexKeep* ページ間を移動しても `TempData["Message"]` は削除されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-506">Navigating between the *IndexPeek* and *IndexKeep* pages won't delete `TempData["Message"]`.</span></span>

<span data-ttu-id="c5809-507">次のコードでは `TempData["Message"]` が表示されますが、要求の最後に `TempData["Message"]` が削除されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-507">The following code displays `TempData["Message"]`, but at the end of the request, `TempData["Message"]` is deleted:</span></span>

[!code-cshtml[](app-state/3.0samples/RazorPagesContacts/Pages/Customers/Index.cshtml?range=1-14)]

### <a name="tempdata-providers"></a><span data-ttu-id="c5809-508">TempData プロバイダー</span><span class="sxs-lookup"><span data-stu-id="c5809-508">TempData providers</span></span>

<span data-ttu-id="c5809-509">cookie に TempData を格納するには、既定では、cookie ベースの TempData プロバイダーが使われます。</span><span class="sxs-lookup"><span data-stu-id="c5809-509">The cookie-based TempData provider is used by default to store TempData in cookies.</span></span>

<span data-ttu-id="c5809-510">cookie データは、<xref:Microsoft.AspNetCore.DataProtection.IDataProtector> を使用して暗号化され、<xref:Microsoft.AspNetCore.WebUtilities.Base64UrlTextEncoder> でエンコードされた後、チャンクされます。</span><span class="sxs-lookup"><span data-stu-id="c5809-510">The cookie data is encrypted using <xref:Microsoft.AspNetCore.DataProtection.IDataProtector>, encoded with <xref:Microsoft.AspNetCore.WebUtilities.Base64UrlTextEncoder>, then chunked.</span></span> <span data-ttu-id="c5809-511">cookie はチャンクされるため、ASP.NET Core 1.x の 1 cookie のサイズ上限は適用されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-511">Because the cookie is chunked, the single cookie size limit found in ASP.NET Core 1.x doesn't apply.</span></span> <span data-ttu-id="c5809-512">暗号化されているデータを圧縮すると、[CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) 攻撃や [BREACH](https://wikipedia.org/wiki/BREACH_(security_exploit)) 攻撃など、セキュリティ上の問題を起す可能性があるため、cookie データは圧縮されません。</span><span class="sxs-lookup"><span data-stu-id="c5809-512">The cookie data isn't compressed because compressing encrypted data can lead to security problems such as the [CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) and [BREACH](https://wikipedia.org/wiki/BREACH_(security_exploit)) attacks.</span></span> <span data-ttu-id="c5809-513">cookie ベース TempData プロバイダーの詳細については、<xref:Microsoft.AspNetCore.Mvc.ViewFeatures.CookieTempDataProvider> に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-513">For more information on the cookie-based TempData provider, see <xref:Microsoft.AspNetCore.Mvc.ViewFeatures.CookieTempDataProvider>.</span></span>

### <a name="choose-a-tempdata-provider"></a><span data-ttu-id="c5809-514">TempData プロバイダーを選択する</span><span class="sxs-lookup"><span data-stu-id="c5809-514">Choose a TempData provider</span></span>

<span data-ttu-id="c5809-515">TempData プロバイダーを選択するときの考慮事項:</span><span class="sxs-lookup"><span data-stu-id="c5809-515">Choosing a TempData provider involves several considerations, such as:</span></span>

1. <span data-ttu-id="c5809-516">アプリは既にセッション状態を使っているかどうか。</span><span class="sxs-lookup"><span data-stu-id="c5809-516">Does the app already use session state?</span></span> <span data-ttu-id="c5809-517">使っている場合、(データのサイズを除き) セッション状態 TempData プロバイダーがそのアプリにコストを追加することはありません。</span><span class="sxs-lookup"><span data-stu-id="c5809-517">If so, using the session state TempData provider has no additional cost to the app (aside from the size of the data).</span></span>
2. <span data-ttu-id="c5809-518">アプリでは、比較的少量のデータに対して (最大 500 バイト) TempData がわずかばかり使用されているか。</span><span class="sxs-lookup"><span data-stu-id="c5809-518">Does the app use TempData only sparingly for relatively small amounts of data (up to 500 bytes)?</span></span> <span data-ttu-id="c5809-519">該当する場合、cookie TempData プロバイダーによって TempData を送信する要求ごとに少額のコストが追加されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-519">If so, the cookie TempData provider adds a small cost to each request that carries TempData.</span></span> <span data-ttu-id="c5809-520">該当しない場合、セッション状態 TempData プロバイダーは便利かもしれません。TempData が尽きるまで、要求のたびに大量のデータをラウンドトリップすることが回避されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-520">If not, the session state TempData provider can be beneficial to avoid round-tripping a large amount of data in each request until the TempData is consumed.</span></span>
3. <span data-ttu-id="c5809-521">アプリは複数サーバーのサーバー ファームで実行しているか。</span><span class="sxs-lookup"><span data-stu-id="c5809-521">Does the app run in a server farm on multiple servers?</span></span> <span data-ttu-id="c5809-522">そうである場合は、データ保護の外部で cookie TempData プロバイダーを使用するために、追加の構成は必要ありません (「<xref:security/data-protection/introduction>」および[キー ストレージ プロバイダー](xref:security/data-protection/implementation/key-storage-providers)に関する記事を参照)。</span><span class="sxs-lookup"><span data-stu-id="c5809-522">If so, there's no additional configuration required to use the cookie TempData provider outside of Data Protection (see <xref:security/data-protection/introduction> and [Key storage providers](xref:security/data-protection/implementation/key-storage-providers)).</span></span>

> [!NOTE]
> <span data-ttu-id="c5809-523">Web ブラウザーなどのほとんどの Web クライアントによって、各 cookie の最大サイズ、cookie の合計数、またはその両方に上限が設けられます。</span><span class="sxs-lookup"><span data-stu-id="c5809-523">Most web clients (such as web browsers) enforce limits on the maximum size of each cookie, the total number of cookies, or both.</span></span> <span data-ttu-id="c5809-524">cookie TempData プロバイダーを使用するとき、アプリでそれらの上限が超えないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-524">When using the cookie TempData provider, verify the app won't exceed these limits.</span></span> <span data-ttu-id="c5809-525">データの合計サイズを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-525">Consider the total size of the data.</span></span> <span data-ttu-id="c5809-526">暗号化とチャンクによる cookie のサイズの増加を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-526">Account for increases in cookie size due to encryption and chunking.</span></span>

### <a name="configure-the-tempdata-provider"></a><span data-ttu-id="c5809-527">TempData プロバイダーを構成する</span><span class="sxs-lookup"><span data-stu-id="c5809-527">Configure the TempData provider</span></span>

<span data-ttu-id="c5809-528">cookie ベース TempData プロバイダーは既定で有効になります。</span><span class="sxs-lookup"><span data-stu-id="c5809-528">The cookie-based TempData provider is enabled by default.</span></span>

<span data-ttu-id="c5809-529">セッション ベースの TempData プロバイダーを有効にするには、<xref:Microsoft.Extensions.DependencyInjection.MvcViewFeaturesMvcBuilderExtensions.AddSessionStateTempDataProvider%2A> 拡張メソッドを使います。</span><span class="sxs-lookup"><span data-stu-id="c5809-529">To enable the session-based TempData provider, use the <xref:Microsoft.Extensions.DependencyInjection.MvcViewFeaturesMvcBuilderExtensions.AddSessionStateTempDataProvider%2A> extension method:</span></span>

[!code-csharp[](app-state/samples_snapshot_2/2.x/SessionSample/Startup.cs?name=snippet1&highlight=11,13,32)]

<span data-ttu-id="c5809-530">ミドルウェアの順序が重要です。</span><span class="sxs-lookup"><span data-stu-id="c5809-530">The order of middleware is important.</span></span> <span data-ttu-id="c5809-531">上の例では、`UseMvc` の後で `UseSession` を呼び出すと、`InvalidOperationException` 例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="c5809-531">In the preceding example, an `InvalidOperationException` exception occurs when `UseSession` is invoked after `UseMvc`.</span></span> <span data-ttu-id="c5809-532">詳細については、[ミドルウェアの順序](xref:fundamentals/middleware/index#order)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c5809-532">For more information, see [Middleware Ordering](xref:fundamentals/middleware/index#order).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5809-533">.NET Framework が対象で、セッション ベースの TempData プロバイダーを使う場合は、[Microsoft.AspNetCore.Session](https://www.nuget.org/packages/Microsoft.AspNetCore.Session/) パッケージをプロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="c5809-533">If targeting .NET Framework and using the session-based TempData provider, add the [Microsoft.AspNetCore.Session](https://www.nuget.org/packages/Microsoft.AspNetCore.Session/) package to the project.</span></span>

## <a name="query-strings"></a><span data-ttu-id="c5809-534">クエリ文字列</span><span class="sxs-lookup"><span data-stu-id="c5809-534">Query strings</span></span>

<span data-ttu-id="c5809-535">限られた量のデータを要求間で渡すことができます。新しい要求のクエリ文字列にそれを追加します。</span><span class="sxs-lookup"><span data-stu-id="c5809-535">A limited amount of data can be passed from one request to another by adding it to the new request's query string.</span></span> <span data-ttu-id="c5809-536">これは、リンクと埋め込まれた状態がメールまたはソーシャル ネットワークを通して共有されるよう、永久的に状態をキャプチャするのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c5809-536">This is useful for capturing state in a persistent manner that allows links with embedded state to be shared through email or social networks.</span></span> <span data-ttu-id="c5809-537">URL クエリ文字列はパブリックであるため、機密データにはクエリ文字列を使わないでください。</span><span class="sxs-lookup"><span data-stu-id="c5809-537">Because URL query strings are public, never use query strings for sensitive data.</span></span>

<span data-ttu-id="c5809-538">意図しない共有が発生するだけでなく、クエリ文字列にデータを含めると、[クロスサイト リクエスト フォージェリ (CSRF)](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)) 攻撃の機会を与えてしまいます。認証中、ユーザーをだまして悪意のあるサイトに誘導します。</span><span class="sxs-lookup"><span data-stu-id="c5809-538">In addition to unintended sharing, including data in query strings can create opportunities for [Cross-Site Request Forgery (CSRF)](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)) attacks, which can trick users into visiting malicious sites while authenticated.</span></span> <span data-ttu-id="c5809-539">攻撃者はアプリからユーザー データを盗んだり、ユーザーになりすまして悪意のある行為を行ったりできます。</span><span class="sxs-lookup"><span data-stu-id="c5809-539">Attackers can then steal user data from the app or take malicious actions on behalf of the user.</span></span> <span data-ttu-id="c5809-540">保存されるアプリまたはセッション状態は CSRF 攻撃を防ぐ必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-540">Any preserved app or session state must protect against CSRF attacks.</span></span> <span data-ttu-id="c5809-541">詳細については、「<xref:security/anti-request-forgery>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-541">For more information, see <xref:security/anti-request-forgery>.</span></span>

## <a name="hidden-fields"></a><span data-ttu-id="c5809-542">非表示フィールド</span><span class="sxs-lookup"><span data-stu-id="c5809-542">Hidden fields</span></span>

<span data-ttu-id="c5809-543">データは非表示フォーム フィールドに保存したり、次の要求で転記したりできます。</span><span class="sxs-lookup"><span data-stu-id="c5809-543">Data can be saved in hidden form fields and posted back on the next request.</span></span> <span data-ttu-id="c5809-544">複数ページ フォームでは、これは一般的です。</span><span class="sxs-lookup"><span data-stu-id="c5809-544">This is common in multi-page forms.</span></span> <span data-ttu-id="c5809-545">クライアントがデータを改ざんする可能性があるため、アプリで非表示フィールドに格納されているデータを常に再検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-545">Because the client can potentially tamper with the data, the app must always revalidate the data stored in hidden fields.</span></span>

## <a name="httpcontextitems"></a><span data-ttu-id="c5809-546">HttpContext.Items</span><span class="sxs-lookup"><span data-stu-id="c5809-546">HttpContext.Items</span></span>

<span data-ttu-id="c5809-547">1 つの要求を処理している間にデータを格納するには、<xref:Microsoft.AspNetCore.Http.HttpContext.Items?displayProperty=nameWithType> コレクションを使います。</span><span class="sxs-lookup"><span data-stu-id="c5809-547">The <xref:Microsoft.AspNetCore.Http.HttpContext.Items?displayProperty=nameWithType> collection is used to store data while processing a single request.</span></span> <span data-ttu-id="c5809-548">要求が処理された後、コレクションの内容は破棄されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-548">The collection's contents are discarded after a request is processed.</span></span> <span data-ttu-id="c5809-549">`Items` コレクションは、コンポーネントまたはミドルウェアが要求の間の異なる時点で動作し、パラメーターを受け渡す直接的な方法がない場合に、コンポーネントとミドルウェアが通信できるようにするためによく使われます。</span><span class="sxs-lookup"><span data-stu-id="c5809-549">The `Items` collection is often used to allow components or middleware to communicate when they operate at different points in time during a request and have no direct way to pass parameters.</span></span>

<span data-ttu-id="c5809-550">次の例では、[ミドルウェア](xref:fundamentals/middleware/index)により `isVerified` が `Items` コレクションに追加されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-550">In the following example, [middleware](xref:fundamentals/middleware/index) adds `isVerified` to the `Items` collection.</span></span>

```csharp
app.Use(async (context, next) =>
{
    // perform some verification
    context.Items["isVerified"] = true;
    await next.Invoke();
});
```

<span data-ttu-id="c5809-551">後のパイプラインで、別のミドルウェアが `isVerified` の値にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c5809-551">Later in the pipeline, another middleware can access the value of `isVerified`:</span></span>

```csharp
app.Run(async (context) =>
{
    await context.Response.WriteAsync($"Verified: {context.Items["isVerified"]}");
});
```

<span data-ttu-id="c5809-552">1 つのアプリでのみ使用されるミドルウェアの場合、`string` キーが許容されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-552">For middleware that's only used by a single app, `string` keys are acceptable.</span></span> <span data-ttu-id="c5809-553">アプリのインスタンス間で共有されるミドルウェアでは、キーの競合を避けるため、一意のオブジェクト キーを使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="c5809-553">Middleware shared between app instances should use unique object keys to avoid key collisions.</span></span> <span data-ttu-id="c5809-554">次の例では、ミドルウェア クラスで定義されている一意のオブジェクト キーを使用する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c5809-554">The following example shows how to use a unique object key defined in a middleware class:</span></span>

[!code-csharp[](app-state/samples/2.x/SessionSample/Middleware/HttpContextItemsMiddleware.cs?name=snippet1&highlight=4,13)]

<span data-ttu-id="c5809-555">その他のコードは、ミドルウェア クラスで公開されるキーを利用し、`HttpContext.Items` に格納されている値にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c5809-555">Other code can access the value stored in `HttpContext.Items` using the key exposed by the middleware class:</span></span>

[!code-csharp[](app-state/samples/2.x/SessionSample/Pages/Index.cshtml.cs?name=snippet3)]

<span data-ttu-id="c5809-556">この方法には、コード内でキーの文字列を使用する必要がないという利点もあります。</span><span class="sxs-lookup"><span data-stu-id="c5809-556">This approach also has the advantage of eliminating the use of key strings in the code.</span></span>

## <a name="cache"></a><span data-ttu-id="c5809-557">キャッシュ</span><span class="sxs-lookup"><span data-stu-id="c5809-557">Cache</span></span>

<span data-ttu-id="c5809-558">キャッシュは、データを保存し、取得する効率的な方法です。</span><span class="sxs-lookup"><span data-stu-id="c5809-558">Caching is an efficient way to store and retrieve data.</span></span> <span data-ttu-id="c5809-559">アプリでは、キャッシュされた項目の有効期間を制御できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-559">The app can control the lifetime of cached items.</span></span>

<span data-ttu-id="c5809-560">キャッシュされたデータは、特定の要求、ユーザー、またはセッションに関連付けられていません。</span><span class="sxs-lookup"><span data-stu-id="c5809-560">Cached data isn't associated with a specific request, user, or session.</span></span> <span data-ttu-id="c5809-561">**他のユーザーの要求によって取得される可能性があるので、ユーザー固有データをキャッシュしないように注意してください。**</span><span class="sxs-lookup"><span data-stu-id="c5809-561">**Be careful not to cache user-specific data that may be retrieved by other users' requests.**</span></span>

<span data-ttu-id="c5809-562">詳細については、「<xref:performance/caching/response>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c5809-562">For more information, see <xref:performance/caching/response>.</span></span>

## <a name="dependency-injection"></a><span data-ttu-id="c5809-563">依存関係の挿入</span><span class="sxs-lookup"><span data-stu-id="c5809-563">Dependency Injection</span></span>

<span data-ttu-id="c5809-564">[依存関係の注入](xref:fundamentals/dependency-injection)を利用し、すべてのユーザーがデータを利用できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c5809-564">Use [Dependency Injection](xref:fundamentals/dependency-injection) to make data available to all users:</span></span>

1. <span data-ttu-id="c5809-565">データを含むサービスを定義します。</span><span class="sxs-lookup"><span data-stu-id="c5809-565">Define a service containing the data.</span></span> <span data-ttu-id="c5809-566">たとえば、`MyAppData` という名前のクラスを定義します。</span><span class="sxs-lookup"><span data-stu-id="c5809-566">For example, a class named `MyAppData` is defined:</span></span>

    ```csharp
    public class MyAppData
    {
        // Declare properties and methods
    }
    ```

2. <span data-ttu-id="c5809-567">サービス クラスを `Startup.ConfigureServices` に追加します。</span><span class="sxs-lookup"><span data-stu-id="c5809-567">Add the service class to `Startup.ConfigureServices`:</span></span>

    ```csharp
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddSingleton<MyAppData>();
    }
    ```

3. <span data-ttu-id="c5809-568">データ サービス クラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="c5809-568">Consume the data service class:</span></span>

    ```csharp
    public class IndexModel : PageModel
    {
        public IndexModel(MyAppData myService)
        {
            // Do something with the service
            //    Examples: Read data, store in a field or property
        }
    }
    ```

## <a name="common-errors"></a><span data-ttu-id="c5809-569">一般的なエラー</span><span class="sxs-lookup"><span data-stu-id="c5809-569">Common errors</span></span>

* <span data-ttu-id="c5809-570">"'Microsoft.AspNetCore.Session.DistributedSessionStore' を起動しようとしましたが、型 'Microsoft.Extensions.Caching.Distributed.IDistributedCache' のサービスを解決できません。"</span><span class="sxs-lookup"><span data-stu-id="c5809-570">"Unable to resolve service for type 'Microsoft.Extensions.Caching.Distributed.IDistributedCache' while attempting to activate 'Microsoft.AspNetCore.Session.DistributedSessionStore'."</span></span>

  <span data-ttu-id="c5809-571">これは通常、少なくとも 1 つの `IDistributedCache` 実装で構成に失敗したことで発生します。</span><span class="sxs-lookup"><span data-stu-id="c5809-571">This is usually caused by failing to configure at least one `IDistributedCache` implementation.</span></span> <span data-ttu-id="c5809-572">詳細については、次のトピックを参照してください。 <xref:performance/caching/distributed> および <xref:performance/caching/memory></span><span class="sxs-lookup"><span data-stu-id="c5809-572">For more information, see <xref:performance/caching/distributed> and <xref:performance/caching/memory>.</span></span>

* <span data-ttu-id="c5809-573">セッション ミドルウェアがセッションを永続化できなかった場合 (バッキング ストアを利用できない場合など)、ミドルウェアは例外をログに記録し、要求は普通に続行されます。</span><span class="sxs-lookup"><span data-stu-id="c5809-573">In the event that the session middleware fails to persist a session (for example, if the backing store isn't available), the middleware logs the exception and the request continues normally.</span></span> <span data-ttu-id="c5809-574">これにより、予期しない動作が発生します。</span><span class="sxs-lookup"><span data-stu-id="c5809-574">This leads to unpredictable behavior.</span></span>

  <span data-ttu-id="c5809-575">たとえば、ユーザーがセッションでショッピング カートを格納します。</span><span class="sxs-lookup"><span data-stu-id="c5809-575">For example, a user stores a shopping cart in session.</span></span> <span data-ttu-id="c5809-576">ユーザーはアイテムをカートに追加しますが、コミットが失敗します。</span><span class="sxs-lookup"><span data-stu-id="c5809-576">The user adds an item to the cart but the commit fails.</span></span> <span data-ttu-id="c5809-577">アプリはこの失敗を認識しないので、アイテムがカートに追加されたことをユーザーに伝えますが、これは正しくありません。</span><span class="sxs-lookup"><span data-stu-id="c5809-577">The app doesn't know about the failure so it reports to the user that the item was added to their cart, which isn't true.</span></span>

  <span data-ttu-id="c5809-578">エラーを確認するための推奨される方法は、アプリがセッションへの書き込みを終了したら、アプリ コードから `await feature.Session.CommitAsync();` を呼び出すことです。</span><span class="sxs-lookup"><span data-stu-id="c5809-578">The recommended approach to check for errors is to call `await feature.Session.CommitAsync();` from app code when the app is done writing to the session.</span></span> <span data-ttu-id="c5809-579">バッキング ストアが利用できない場合、`CommitAsync` は例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="c5809-579">`CommitAsync` throws an exception if the backing store is unavailable.</span></span> <span data-ttu-id="c5809-580">`CommitAsync` が失敗した場合、アプリは例外を処理できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-580">If `CommitAsync` fails, the app can process the exception.</span></span> <span data-ttu-id="c5809-581">`LoadAsync` は、データ ストアが利用できない場合に同じ条件で例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="c5809-581">`LoadAsync` throws under the same conditions where the data store is unavailable.</span></span>
  
## <a name="no-locsignalr-and-session-state"></a><span data-ttu-id="c5809-582">SignalR とセッション状態</span><span class="sxs-lookup"><span data-stu-id="c5809-582">SignalR and session state</span></span>

<span data-ttu-id="c5809-583">SignalR アプリでは、セッション状態を使用して情報を格納することはできません。</span><span class="sxs-lookup"><span data-stu-id="c5809-583">SignalR apps should not use session state to store information.</span></span> <span data-ttu-id="c5809-584">SignalR アプリは、ハブ内の `Context.Items` に接続ごとの状態を格納できます。</span><span class="sxs-lookup"><span data-stu-id="c5809-584">SignalR apps can store per connection state in `Context.Items` in the hub.</span></span> <!-- https://github.com/aspnet/SignalR/issues/2139 -->

## <a name="additional-resources"></a><span data-ttu-id="c5809-585">その他の技術情報</span><span class="sxs-lookup"><span data-stu-id="c5809-585">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
::: moniker-end
